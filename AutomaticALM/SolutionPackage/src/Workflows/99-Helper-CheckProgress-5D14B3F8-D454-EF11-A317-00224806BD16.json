{
  "properties": {
    "connectionReferences": {
      "shared_visualstudioteamservices": {
        "api": {
          "name": "shared_visualstudioteamservices"
        },
        "connection": {
          "connectionReferenceLogicalName": "dyna_sharedvisualstudioteamservices_0874f"
        },
        "runtimeSource": "embedded"
      },
      "shared_commondataserviceforapps": {
        "api": {
          "name": "shared_commondataserviceforapps"
        },
        "connection": {
          "connectionReferenceLogicalName": "dyna_sharedcommondataserviceforapps_c708f"
        },
        "runtimeSource": "embedded"
      },
      "shared_office365": {
        "api": {
          "name": "shared_office365"
        },
        "connection": {
          "connectionReferenceLogicalName": "dyna_sharedoffice365_ea39d"
        },
        "runtimeSource": "embedded"
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)": {
          "defaultValue": "aurelienclere",
          "type": "String",
          "metadata": {
            "schemaName": "dyna_almdevopsorganizationname",
            "description": "Name of DevOps Organization"
          }
        },
        "ALM_DevOps_ProjectName (dyna_almdevopsprojectname)": {
          "defaultValue": "Automate ALM Accelerator",
          "type": "String",
          "metadata": {
            "schemaName": "dyna_almdevopsprojectname",
            "description": "Name of the DevOps Project link to ALM"
          }
        },
        "ALM_DLToNotify (dyna_ALM_DLToNotify)": {
          "defaultValue": "aurelien.clere@dynagile.fr",
          "type": "String",
          "metadata": {
            "schemaName": "dyna_ALM_DLToNotify",
            "description": "Email to be notified in case of Error. Could be a distribution list email address"
          }
        },
        "ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)": {
          "defaultValue": 12,
          "type": "Int",
          "metadata": {
            "schemaName": "dyna_ALM_RetryDelayMinutes",
            "description": "Number of minutes in delay between each retry"
          }
        },
        "ALM_RetryMax (dyna_ALM_RetryMax)": {
          "defaultValue": 5,
          "type": "Int",
          "metadata": {
            "schemaName": "dyna_ALM_RetryMax",
            "description": "Number of Retry when build in error"
          }
        },
        "ALM_DevOps_RepositoryID (dyna_almdevopsrepositoryid)": {
          "defaultValue": "f7b491b9-5c31-40b1-8741-c3b7c5f08507",
          "type": "String",
          "metadata": {
            "schemaName": "dyna_almdevopsrepositoryid",
            "description": "Id (GIT) of the DevOps Repo - You can setup after with the Flow 0 SetupConfig"
          }
        }
      },
      "triggers": {
        "manual": {
          "type": "Request",
          "kind": "Button",
          "inputs": {
            "schema": {
              "type": "object",
              "properties": {
                "text": {
                  "title": "buildId",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                },
                "text_1": {
                  "title": "solutionName",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                },
                "text_2": {
                  "title": "Type",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "QA or PROD",
                  "x-ms-content-hint": "TEXT"
                },
                "text_3": {
                  "description": "Please enter your input",
                  "title": "ALMDeploymentId",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_4": {
                  "description": "Please enter your input",
                  "title": "ALMSolutionId",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                }
              },
              "required": [
                "text",
                "text_1",
                "text_2",
                "text_3",
                "text_4"
              ]
            }
          },
          "metadata": {
            "operationMetadataId": "829deba4-ed00-496d-9ef0-68246b0122dc"
          }
        }
      },
      "actions": {
        "QA_Only_-_Check_1st_Stage_of_Export": {
          "type": "If",
          "expression": {
            "and": [
              {
                "equals": [
                  "@triggerBody()?['text_2']",
                  "QA"
                ]
              },
              {
                "equals": [
                  "@variables('GoOnOrNot')",
                  true
                ]
              }
            ]
          },
          "actions": {
            "Do_until": {
              "type": "Until",
              "expression": "@equals(variables('DoUntilBooleanLoop'),false)",
              "limit": {
                "count": 3600,
                "timeout": "PT24H"
              },
              "actions": {
                "Get_Status_of_Export_Git_Build": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "parameters/Method": "GET",
                      "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "HttpRequest",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  }
                },
                "Parse_Get_Status_of_Export_Git_Build": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@body('Get_Status_of_Export_Git_Build')",
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "web": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "sourceVersionDisplayUri": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "timeline": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "badge": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {}
                        },
                        "tags": {
                          "type": "array"
                        },
                        "validationResults": {
                          "type": "array"
                        },
                        "plans": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "planId": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "planId"
                            ]
                          }
                        },
                        "templateParameters": {
                          "type": "object",
                          "properties": {
                            "Branch": {
                              "type": "string"
                            },
                            "BranchToCreate": {
                              "type": "string"
                            },
                            "BuildDefinitionId": {
                              "type": "string"
                            },
                            "CommitMessage": {
                              "type": "string"
                            },
                            "CommitScope": {
                              "type": "string"
                            },
                            "DATA": {
                              "type": "string"
                            },
                            "Email": {
                              "type": "string"
                            },
                            "EnvironmentName": {
                              "type": "string"
                            },
                            "ImportUnmanaged": {
                              "type": "string"
                            },
                            "PipelineId": {
                              "type": "string"
                            },
                            "PortalSiteName": {
                              "type": "string"
                            },
                            "Project": {
                              "type": "string"
                            },
                            "PublishCustomizations": {
                              "type": "string"
                            },
                            "Repo": {
                              "type": "string"
                            },
                            "ServiceConnectionName": {
                              "type": "string"
                            },
                            "ServiceConnectionUrl": {
                              "type": "string"
                            },
                            "SolutionName": {
                              "type": "string"
                            },
                            "UserName": {
                              "type": "string"
                            },
                            "AgentPool": {
                              "type": "string"
                            },
                            "VMImage": {
                              "type": "string"
                            }
                          }
                        },
                        "triggerInfo": {
                          "type": "object",
                          "properties": {}
                        },
                        "id": {
                          "type": "integer"
                        },
                        "buildNumber": {
                          "type": "string"
                        },
                        "Status": {
                          "type": "string"
                        },
                        "result": {
                          "type": "string"
                        },
                        "queueTime": {
                          "type": "string"
                        },
                        "startTime": {
                          "type": "string"
                        },
                        "finishTime": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "definition": {
                          "type": "object",
                          "properties": {
                            "drafts": {
                              "type": "array"
                            },
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "uri": {
                              "type": "string"
                            },
                            "path": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "queueStatus": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "project": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "url": {
                                  "type": "string"
                                },
                                "state": {
                                  "type": "string"
                                },
                                "revision": {
                                  "type": "integer"
                                },
                                "visibility": {
                                  "type": "string"
                                },
                                "lastUpdateTime": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "project": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "description": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "state": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "visibility": {
                              "type": "string"
                            },
                            "lastUpdateTime": {
                              "type": "string"
                            }
                          }
                        },
                        "uri": {
                          "type": "string"
                        },
                        "sourceBranch": {
                          "type": "string"
                        },
                        "sourceVersion": {
                          "type": "string"
                        },
                        "queue": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "pool": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "integer"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "isHosted": {
                                  "type": "boolean"
                                }
                              }
                            }
                          }
                        },
                        "priority": {
                          "type": "string"
                        },
                        "reason": {
                          "type": "string"
                        },
                        "requestedFor": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "requestedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "lastChangedDate": {
                          "type": "string"
                        },
                        "lastChangedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "orchestrationPlan": {
                          "type": "object",
                          "properties": {
                            "planId": {
                              "type": "string"
                            }
                          }
                        },
                        "logs": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "type": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            }
                          }
                        },
                        "repository": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "clean": {},
                            "checkoutSubmodules": {
                              "type": "boolean"
                            }
                          }
                        },
                        "retainedByRelease": {
                          "type": "boolean"
                        },
                        "appendCommitMessageToRunName": {
                          "type": "boolean"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Get_Status_of_Export_Git_Build": [
                      "Succeeded"
                    ]
                  }
                },
                "Set_Build_Status": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "buildStatus",
                    "value": "@body('Parse_Get_Status_of_Export_Git_Build')?['result']"
                  },
                  "runAfter": {
                    "Parse_Get_Status_of_Export_Git_Build": [
                      "Succeeded"
                    ]
                  }
                },
                "CurrentStatus": {
                  "type": "Compose",
                  "inputs": "@variables('buildStatus')",
                  "runAfter": {
                    "Set_Build_Status": [
                      "Succeeded"
                    ]
                  }
                },
                "Switch": {
                  "type": "Switch",
                  "expression": "@outputs('CurrentStatus')",
                  "default": {
                    "actions": {
                      "Delay_1mn_each_call": {
                        "type": "Wait",
                        "inputs": {
                          "interval": {
                            "count": 1,
                            "unit": "Minute"
                          }
                        }
                      }
                    }
                  },
                  "cases": {
                    "Case_Success": {
                      "actions": {
                        "Set_variable": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_3": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_3": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": true
                          }
                        },
                        "Update_Log": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Export DEV",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 1
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "succeeded"
                    },
                    "Case_partiallySucceeded": {
                      "actions": {
                        "Set_variable_1": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_4": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_4": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": false
                          }
                        },
                        "Update_Log_2": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Export DEV",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 538000002
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable_1": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "partiallySucceeded"
                    },
                    "Case_failed": {
                      "actions": {
                        "Get_All_Logs_of_the_Build": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                              "parameters/Method": "GET",
                              "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                              "operationId": "HttpRequest",
                              "connectionName": "shared_visualstudioteamservices"
                            }
                          }
                        },
                        "Parse_All_Logs": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_All_Logs_of_the_Build')",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "value": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "lineCount": {
                                        "type": "integer"
                                      },
                                      "createdOn": {
                                        "type": "string"
                                      },
                                      "lastChangedOn": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "lineCount",
                                      "createdOn",
                                      "lastChangedOn",
                                      "id",
                                      "type",
                                      "url"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Get_All_Logs_of_the_Build": [
                              "Succeeded"
                            ]
                          }
                        },
                        "For_each": {
                          "type": "Foreach",
                          "foreach": "@outputs('Parse_All_Logs')?['body']?['value']",
                          "actions": {
                            "Get_specific_log_by_id": {
                              "type": "OpenApiConnection",
                              "inputs": {
                                "parameters": {
                                  "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                  "parameters/Method": "GET",
                                  "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs/@{item()?['id']}"
                                },
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                  "operationId": "HttpRequest",
                                  "connectionName": "shared_visualstudioteamservices"
                                }
                              }
                            },
                            "Condition_only_Error": {
                              "type": "If",
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@body('Get_specific_log_by_id')",
                                      "##[error]"
                                    ]
                                  }
                                ]
                              },
                              "actions": {
                                "Condition_Retry": {
                                  "type": "If",
                                  "expression": {
                                    "and": [
                                      {
                                        "less": [
                                          "@variables('Retry')",
                                          "@parameters('ALM_RetryMax (dyna_ALM_RetryMax)')"
                                        ]
                                      },
                                      {
                                        "contains": [
                                          "@body('Get_specific_log_by_id')",
                                          "Cannot start"
                                        ]
                                      }
                                    ]
                                  },
                                  "actions": {
                                    "Condition_8": {
                                      "type": "If",
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@variables('RetryBool')",
                                              false
                                            ]
                                          }
                                        ]
                                      },
                                      "actions": {
                                        "Increment_Retry": {
                                          "type": "IncrementVariable",
                                          "inputs": {
                                            "name": "Retry",
                                            "value": 1
                                          }
                                        },
                                        "Retry": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                              "parameters/Method": "PATCH",
                                              "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}?retry=true&api-version=7.1-preview.7"
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                              "operationId": "HttpRequest",
                                              "connectionName": "shared_visualstudioteamservices"
                                            }
                                          },
                                          "runAfter": {
                                            "Increment_Retry": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Delay_Retry": {
                                          "type": "Wait",
                                          "inputs": {
                                            "interval": {
                                              "count": "@parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)')",
                                              "unit": "Minute"
                                            }
                                          },
                                          "runAfter": {
                                            "Add_Retry_Log": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Set_variable_27": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "RetryBool",
                                            "value": true
                                          },
                                          "runAfter": {
                                            "Retry": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Add_Retry_Log": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "entityName": "dyna_almtrackinghistories",
                                              "item/dyna_name": "Export DEV",
                                              "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                                              "item/dyna_buildid": "@triggerBody()?['text']",
                                              "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{triggerBody()?['text']}&view=results",
                                              "item/dyna_enddatetime": "@addMinutes(utcNow(),parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)'))",
                                              "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                                              "item/dyna_startdatetime": "@utcNow()",
                                              "item/statuscode": 538000004
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                              "operationId": "CreateRecord",
                                              "connectionName": "shared_commondataserviceforapps"
                                            }
                                          },
                                          "runAfter": {
                                            "Set_variable_27": [
                                              "Succeeded"
                                            ]
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {}
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Condition_3": {
                                        "type": "If",
                                        "expression": {
                                          "and": [
                                            {
                                              "equals": [
                                                "@variables('sentEmail')",
                                                false
                                              ]
                                            }
                                          ]
                                        },
                                        "actions": {
                                          "Send_an_email_(V2)": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "emailMessage/To": "@parameters('ALM_DLToNotify (dyna_ALM_DLToNotify)')",
                                                "emailMessage/Subject": "DevOps Error Automation ALM Accelerator",
                                                "emailMessage/Body": "<p class=\"editor-paragraph\">Orga DevOps : @{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}</p><p class=\"editor-paragraph\">Project DevOps : @{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}</p><br><p class=\"editor-paragraph\">Solution : @{triggerBody()?['text_1']}</p><p class=\"editor-paragraph\">Type : <u><b><strong class=\"editor-text-bold editor-text-underline\">Export DEV</strong></b></u></p><br><p class=\"editor-paragraph\">Build Link : @{concat(variables('linkDevOps'),variables('buildId'))}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">----------------------------------------------------------------------------------</p><br><p class=\"editor-paragraph\">@{body('Get_specific_log_by_id')}</p>",
                                                "emailMessage/Importance": "High"
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365",
                                                "operationId": "SendEmailV2",
                                                "connectionName": "shared_office365"
                                              }
                                            }
                                          },
                                          "Set_variable_24": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "sentEmail",
                                              "value": true
                                            },
                                            "runAfter": {
                                              "Send_an_email_(V2)": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_5": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "GoOnOrNot",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_24": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_2": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "DoUntilBooleanLoop",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_5": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Update_Log_3": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "entityName": "dyna_almtrackinghistories",
                                                "recordId": "@body('Add_a_new_Log')?['dyna_almtrackinghistoryid']",
                                                "item/dyna_name": "Export DEV",
                                                "item/dyna_enddatetime": "@utcNow()",
                                                "item/statuscode": 538000001
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                                "operationId": "UpdateRecord",
                                                "connectionName": "shared_commondataserviceforapps"
                                              }
                                            },
                                            "runAfter": {
                                              "Set_variable_2": [
                                                "Succeeded"
                                              ]
                                            }
                                          }
                                        },
                                        "else": {
                                          "actions": {}
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "actions": {}
                              },
                              "runAfter": {
                                "Get_specific_log_by_id": [
                                  "Succeeded"
                                ]
                              }
                            }
                          },
                          "runAfter": {
                            "Set_RetryBool": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_RetryBool": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "RetryBool",
                            "value": false
                          },
                          "runAfter": {
                            "Parse_All_Logs": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "failed"
                    }
                  },
                  "runAfter": {
                    "CurrentStatus": [
                      "Succeeded"
                    ]
                  }
                }
              },
              "runAfter": {
                "Add_a_new_Log": [
                  "Succeeded"
                ]
              }
            },
            "Add_a_new_Log": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "dyna_almtrackinghistories",
                  "item/dyna_name": "Export DEV",
                  "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                  "item/dyna_buildid": "@triggerBody()?['text']",
                  "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{triggerBody()?['text']}&view=results",
                  "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                  "item/dyna_startdatetime": "@utcNow()",
                  "item/statuscode": 538000003
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "connectionName": "shared_commondataserviceforapps"
                }
              }
            }
          },
          "else": {
            "actions": {}
          },
          "runAfter": {
            "Initialize_LinkDevOps": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "6d9dcc1d-f1cf-44da-9500-e9968f4a4d6a"
          }
        },
        "Initialize_BuildId": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "buildId",
                "type": "string",
                "value": "@string(triggerBody()?['text'])"
              }
            ]
          },
          "runAfter": {}
        },
        "Initialize_BuildStatus": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "buildStatus",
                "type": "string"
              }
            ]
          },
          "runAfter": {
            "Initialize_BuildId": [
              "Succeeded"
            ]
          }
        },
        "Initialize_DoUntilBooleanLoop": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "DoUntilBooleanLoop",
                "type": "boolean",
                "value": true
              }
            ]
          },
          "runAfter": {
            "Initialize_BuildStatus": [
              "Succeeded"
            ]
          }
        },
        "QA_Only_-_2nd_Stage_Validation": {
          "type": "If",
          "expression": {
            "and": [
              {
                "equals": [
                  "@triggerBody()?['text_2']",
                  "QA"
                ]
              },
              {
                "equals": [
                  "@variables('GoOnOrNot')",
                  true
                ]
              }
            ]
          },
          "actions": {
            "Reinit_variables": {
              "type": "Scope",
              "actions": {
                "ReInitialize_DoUntilBooleanLoop": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "DoUntilBooleanLoop",
                    "value": true
                  }
                },
                "ReInitialize_GoOnOrNot": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "GoOnOrNot",
                    "value": true
                  },
                  "runAfter": {
                    "ReInitialize_DoUntilBooleanLoop": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_SentEmail": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "sentEmail",
                    "value": false
                  },
                  "runAfter": {
                    "ReInitialize_GoOnOrNot": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_RetryBool": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "RetryBool",
                    "value": false
                  },
                  "runAfter": {
                    "Reinit_SentEmail": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_Retry": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "Retry",
                    "value": 0
                  },
                  "runAfter": {
                    "Reinit_RetryBool": [
                      "Succeeded"
                    ]
                  }
                }
              }
            },
            "Delay_2min_waiting_for_the_PR_to_be_created": {
              "type": "Wait",
              "inputs": {
                "interval": {
                  "count": 2,
                  "unit": "Minute"
                }
              },
              "runAfter": {
                "Reinit_variables": [
                  "Succeeded"
                ]
              }
            },
            "Search_for_Build_id_Validation": {
              "type": "Scope",
              "actions": {
                "List_pipelines": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "project": "@parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "ListPipelines",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  }
                },
                "For_each_1": {
                  "type": "Foreach",
                  "foreach": "@outputs('List_pipelines')?['body/value']",
                  "actions": {
                    "Condition": {
                      "type": "If",
                      "expression": {
                        "and": [
                          {
                            "contains": [
                              "@item()?['name']",
                              "deploy-validation-@{triggerBody()?['text_1']}"
                            ]
                          }
                        ]
                      },
                      "actions": {
                        "Set_variable_6": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "pipelineId",
                            "value": "@item()?['id']"
                          }
                        }
                      },
                      "else": {
                        "actions": {}
                      }
                    }
                  },
                  "runAfter": {
                    "List_pipelines": [
                      "Succeeded"
                    ]
                  }
                },
                "Search_BuildId": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "parameters/Method": "GET",
                      "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds?definitions=@{variables('pipelineId')}&maxBuildsPerDefinition=1&queryOrder=queueTimeDescending"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "HttpRequest",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  },
                  "runAfter": {
                    "For_each_1": [
                      "Succeeded"
                    ]
                  }
                },
                "Parse_JSON_BuildId": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@body('Search_BuildId')",
                    "schema": {
                      "type": "object",
                      "properties": {
                        "count": {
                          "type": "integer"
                        },
                        "value": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "_links": {
                                "type": "object",
                                "properties": {
                                  "self": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "web": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "sourceVersionDisplayUri": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "timeline": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "badge": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                }
                              },
                              "properties": {
                                "type": "object",
                                "properties": {}
                              },
                              "tags": {
                                "type": "array"
                              },
                              "validationResults": {
                                "type": "array"
                              },
                              "plans": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "planId": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "planId"
                                  ]
                                }
                              },
                              "triggerInfo": {
                                "type": "object",
                                "properties": {
                                  "pr.number": {
                                    "type": "string"
                                  },
                                  "pr.isFork": {
                                    "type": "string"
                                  },
                                  "pr.triggerRepository": {
                                    "type": "string"
                                  },
                                  "pr.triggerRepository.Type": {
                                    "type": "string"
                                  }
                                }
                              },
                              "id": {
                                "type": "integer"
                              },
                              "buildNumber": {
                                "type": "string"
                              },
                              "status": {
                                "type": "string"
                              },
                              "queueTime": {
                                "type": "string"
                              },
                              "startTime": {
                                "type": "string"
                              },
                              "url": {
                                "type": "string"
                              },
                              "definition": {
                                "type": "object",
                                "properties": {
                                  "drafts": {
                                    "type": "array"
                                  },
                                  "id": {
                                    "type": "integer"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "uri": {
                                    "type": "string"
                                  },
                                  "path": {
                                    "type": "string"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "queueStatus": {
                                    "type": "string"
                                  },
                                  "revision": {
                                    "type": "integer"
                                  },
                                  "project": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "description": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      },
                                      "state": {
                                        "type": "string"
                                      },
                                      "revision": {
                                        "type": "integer"
                                      },
                                      "visibility": {
                                        "type": "string"
                                      },
                                      "lastUpdateTime": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                }
                              },
                              "buildNumberRevision": {
                                "type": "integer"
                              },
                              "project": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "description": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "state": {
                                    "type": "string"
                                  },
                                  "revision": {
                                    "type": "integer"
                                  },
                                  "visibility": {
                                    "type": "string"
                                  },
                                  "lastUpdateTime": {
                                    "type": "string"
                                  }
                                }
                              },
                              "uri": {
                                "type": "string"
                              },
                              "sourceBranch": {
                                "type": "string"
                              },
                              "sourceVersion": {
                                "type": "string"
                              },
                              "queue": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "pool": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "integer"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "isHosted": {
                                        "type": "boolean"
                                      }
                                    }
                                  }
                                }
                              },
                              "priority": {
                                "type": "string"
                              },
                              "reason": {
                                "type": "string"
                              },
                              "requestedFor": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "requestedBy": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "lastChangedDate": {
                                "type": "string"
                              },
                              "lastChangedBy": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "parameters": {
                                "type": "string"
                              },
                              "orchestrationPlan": {
                                "type": "object",
                                "properties": {
                                  "planId": {
                                    "type": "string"
                                  }
                                }
                              },
                              "logs": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  }
                                }
                              },
                              "repository": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "clean": {},
                                  "checkoutSubmodules": {
                                    "type": "boolean"
                                  }
                                }
                              },
                              "retainedByRelease": {
                                "type": "boolean"
                              },
                              "triggeredByBuild": {},
                              "appendCommitMessageToRunName": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "_links",
                              "properties",
                              "tags",
                              "validationResults",
                              "plans",
                              "triggerInfo",
                              "id",
                              "buildNumber",
                              "status",
                              "queueTime",
                              "startTime",
                              "url",
                              "definition",
                              "buildNumberRevision",
                              "project",
                              "uri",
                              "sourceBranch",
                              "sourceVersion",
                              "queue",
                              "priority",
                              "reason",
                              "requestedFor",
                              "requestedBy",
                              "lastChangedDate",
                              "lastChangedBy",
                              "parameters",
                              "orchestrationPlan",
                              "logs",
                              "repository",
                              "retainedByRelease",
                              "triggeredByBuild",
                              "appendCommitMessageToRunName"
                            ]
                          }
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Search_BuildId": [
                      "Succeeded"
                    ]
                  }
                },
                "For_each_2": {
                  "type": "Foreach",
                  "foreach": "@outputs('Parse_JSON_BuildId')?['body']?['value']",
                  "actions": {
                    "Set_buildId_for_validation_environment": {
                      "type": "SetVariable",
                      "inputs": {
                        "name": "buildId",
                        "value": "@string(item()?['id'])"
                      }
                    }
                  },
                  "runAfter": {
                    "Parse_JSON_BuildId": [
                      "Succeeded"
                    ]
                  }
                }
              },
              "runAfter": {
                "Delay_2min_waiting_for_the_PR_to_be_created": [
                  "Succeeded"
                ]
              }
            },
            "Do_until_validation": {
              "type": "Until",
              "expression": "@equals(variables('DoUntilBooleanLoop'),false)",
              "limit": {
                "count": 3600,
                "timeout": "PT24H"
              },
              "actions": {
                "Get_Status_of_Export_Git_Build_1": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "parameters/Method": "GET",
                      "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "HttpRequest",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  }
                },
                "Parse_Get_Status_of_Export_Git_Build_1": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@body('Get_Status_of_Export_Git_Build_1')",
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "web": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "sourceVersionDisplayUri": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "timeline": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "badge": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {}
                        },
                        "tags": {
                          "type": "array"
                        },
                        "validationResults": {
                          "type": "array"
                        },
                        "plans": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "planId": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "planId"
                            ]
                          }
                        },
                        "templateParameters": {
                          "type": "object",
                          "properties": {
                            "Branch": {
                              "type": "string"
                            },
                            "BranchToCreate": {
                              "type": "string"
                            },
                            "BuildDefinitionId": {
                              "type": "string"
                            },
                            "CommitMessage": {
                              "type": "string"
                            },
                            "CommitScope": {
                              "type": "string"
                            },
                            "DATA": {
                              "type": "string"
                            },
                            "Email": {
                              "type": "string"
                            },
                            "EnvironmentName": {
                              "type": "string"
                            },
                            "ImportUnmanaged": {
                              "type": "string"
                            },
                            "PipelineId": {
                              "type": "string"
                            },
                            "PortalSiteName": {
                              "type": "string"
                            },
                            "Project": {
                              "type": "string"
                            },
                            "PublishCustomizations": {
                              "type": "string"
                            },
                            "Repo": {
                              "type": "string"
                            },
                            "ServiceConnectionName": {
                              "type": "string"
                            },
                            "ServiceConnectionUrl": {
                              "type": "string"
                            },
                            "SolutionName": {
                              "type": "string"
                            },
                            "UserName": {
                              "type": "string"
                            },
                            "AgentPool": {
                              "type": "string"
                            },
                            "VMImage": {
                              "type": "string"
                            }
                          }
                        },
                        "triggerInfo": {
                          "type": "object",
                          "properties": {}
                        },
                        "id": {
                          "type": "integer"
                        },
                        "buildNumber": {
                          "type": "string"
                        },
                        "Status": {
                          "type": "string"
                        },
                        "result": {
                          "type": "string"
                        },
                        "queueTime": {
                          "type": "string"
                        },
                        "startTime": {
                          "type": "string"
                        },
                        "finishTime": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "definition": {
                          "type": "object",
                          "properties": {
                            "drafts": {
                              "type": "array"
                            },
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "uri": {
                              "type": "string"
                            },
                            "path": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "queueStatus": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "project": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "url": {
                                  "type": "string"
                                },
                                "state": {
                                  "type": "string"
                                },
                                "revision": {
                                  "type": "integer"
                                },
                                "visibility": {
                                  "type": "string"
                                },
                                "lastUpdateTime": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "project": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "description": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "state": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "visibility": {
                              "type": "string"
                            },
                            "lastUpdateTime": {
                              "type": "string"
                            }
                          }
                        },
                        "uri": {
                          "type": "string"
                        },
                        "sourceBranch": {
                          "type": "string"
                        },
                        "sourceVersion": {
                          "type": "string"
                        },
                        "queue": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "pool": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "integer"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "isHosted": {
                                  "type": "boolean"
                                }
                              }
                            }
                          }
                        },
                        "priority": {
                          "type": "string"
                        },
                        "reason": {
                          "type": "string"
                        },
                        "requestedFor": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "requestedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "lastChangedDate": {
                          "type": "string"
                        },
                        "lastChangedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "orchestrationPlan": {
                          "type": "object",
                          "properties": {
                            "planId": {
                              "type": "string"
                            }
                          }
                        },
                        "logs": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "type": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            }
                          }
                        },
                        "repository": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "clean": {},
                            "checkoutSubmodules": {
                              "type": "boolean"
                            }
                          }
                        },
                        "retainedByRelease": {
                          "type": "boolean"
                        },
                        "appendCommitMessageToRunName": {
                          "type": "boolean"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Get_Status_of_Export_Git_Build_1": [
                      "Succeeded"
                    ]
                  }
                },
                "Set_Build_Status_1": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "buildStatus",
                    "value": "@body('Parse_Get_Status_of_Export_Git_Build_1')?['result']"
                  },
                  "runAfter": {
                    "Parse_Get_Status_of_Export_Git_Build_1": [
                      "Succeeded"
                    ]
                  }
                },
                "CurrentStatus_1": {
                  "type": "Compose",
                  "inputs": "@variables('buildStatus')",
                  "runAfter": {
                    "Set_Build_Status_1": [
                      "Succeeded"
                    ]
                  }
                },
                "Switch_1": {
                  "type": "Switch",
                  "expression": "@outputs('CurrentStatus_1')",
                  "default": {
                    "actions": {
                      "Delay_1mn_each_call_1": {
                        "type": "Wait",
                        "inputs": {
                          "interval": {
                            "count": 1,
                            "unit": "Minute"
                          }
                        }
                      }
                    }
                  },
                  "cases": {
                    "Case_Success_1": {
                      "actions": {
                        "Set_variable_40": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_8": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_8": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": true
                          }
                        },
                        "Update_Log_4": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log_Validation')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Deploy Validation",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 1
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable_40": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "succeeded"
                    },
                    "Case_partiallySucceeded_1": {
                      "actions": {
                        "Set_variable_9": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_10": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_10": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": false
                          }
                        },
                        "Update_Log_5": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log_Validation')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Deploy Validation",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 538000002
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable_9": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "partiallySucceeded"
                    },
                    "Case_failed_1": {
                      "actions": {
                        "Get_All_Logs_of_the_Build_1": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                              "parameters/Method": "GET",
                              "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                              "operationId": "HttpRequest",
                              "connectionName": "shared_visualstudioteamservices"
                            }
                          }
                        },
                        "Parse_All_Logs_1": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_All_Logs_of_the_Build_1')",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "value": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "lineCount": {
                                        "type": "integer"
                                      },
                                      "createdOn": {
                                        "type": "string"
                                      },
                                      "lastChangedOn": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "lineCount",
                                      "createdOn",
                                      "lastChangedOn",
                                      "id",
                                      "type",
                                      "url"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Get_All_Logs_of_the_Build_1": [
                              "Succeeded"
                            ]
                          }
                        },
                        "For_each_3": {
                          "type": "Foreach",
                          "foreach": "@outputs('Parse_All_Logs_1')?['body']?['value']",
                          "actions": {
                            "Get_specific_log_by_id_1": {
                              "type": "OpenApiConnection",
                              "inputs": {
                                "parameters": {
                                  "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                  "parameters/Method": "GET",
                                  "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs/@{item()?['id']}"
                                },
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                  "operationId": "HttpRequest",
                                  "connectionName": "shared_visualstudioteamservices"
                                }
                              }
                            },
                            "Condition_only_Error_1": {
                              "type": "If",
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@body('Get_specific_log_by_id_1')",
                                      "##[error]"
                                    ]
                                  }
                                ]
                              },
                              "actions": {
                                "Condition_Retry_1": {
                                  "type": "If",
                                  "expression": {
                                    "and": [
                                      {
                                        "less": [
                                          "@variables('Retry')",
                                          "@parameters('ALM_RetryMax (dyna_ALM_RetryMax)')"
                                        ]
                                      },
                                      {
                                        "contains": [
                                          "@body('Get_specific_log_by_id_1')",
                                          "Cannot start"
                                        ]
                                      }
                                    ]
                                  },
                                  "actions": {
                                    "Condition_9": {
                                      "type": "If",
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@variables('RetryBool')",
                                              false
                                            ]
                                          }
                                        ]
                                      },
                                      "actions": {
                                        "Increment_Retry_1": {
                                          "type": "IncrementVariable",
                                          "inputs": {
                                            "name": "Retry",
                                            "value": 1
                                          }
                                        },
                                        "Set_variable_32": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "RetryBool",
                                            "value": true
                                          },
                                          "runAfter": {
                                            "For_each_10": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Delay_Retry_1": {
                                          "type": "Wait",
                                          "inputs": {
                                            "interval": {
                                              "count": "@parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)')",
                                              "unit": "Minute"
                                            }
                                          },
                                          "runAfter": {
                                            "Add_Retry_Validation_Log": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Add_Retry_Validation_Log": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "entityName": "dyna_almtrackinghistories",
                                              "item/dyna_name": "Deploy Validation",
                                              "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                                              "item/dyna_buildid": "@variables('buildId')",
                                              "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{variables('buildId')}&view=results",
                                              "item/dyna_enddatetime": "@addMinutes(utcNow(),parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)'))",
                                              "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                                              "item/dyna_startdatetime": "@utcNow()",
                                              "item/statuscode": 538000004
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                              "operationId": "CreateRecord",
                                              "connectionName": "shared_commondataserviceforapps"
                                            }
                                          },
                                          "runAfter": {
                                            "Set_variable_32": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Get_Build_Infos": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                              "parameters/Method": "GET",
                                              "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}?api-version=7.1-preview.7"
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                              "operationId": "HttpRequest",
                                              "connectionName": "shared_visualstudioteamservices"
                                            }
                                          },
                                          "runAfter": {
                                            "Increment_Retry_1": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Parse_JSON_Get_Build_Infos": {
                                          "type": "ParseJson",
                                          "inputs": {
                                            "content": "@body('Get_Build_Infos')",
                                            "schema": {
                                              "type": "object",
                                              "properties": {
                                                "_links": {
                                                  "type": "object",
                                                  "properties": {
                                                    "self": {
                                                      "type": "object",
                                                      "properties": {
                                                        "href": {
                                                          "type": "string"
                                                        }
                                                      }
                                                    },
                                                    "web": {
                                                      "type": "object",
                                                      "properties": {
                                                        "href": {
                                                          "type": "string"
                                                        }
                                                      }
                                                    },
                                                    "sourceVersionDisplayUri": {
                                                      "type": "object",
                                                      "properties": {
                                                        "href": {
                                                          "type": "string"
                                                        }
                                                      }
                                                    },
                                                    "timeline": {
                                                      "type": "object",
                                                      "properties": {
                                                        "href": {
                                                          "type": "string"
                                                        }
                                                      }
                                                    },
                                                    "badge": {
                                                      "type": "object",
                                                      "properties": {
                                                        "href": {
                                                          "type": "string"
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                "properties": {
                                                  "type": "object"
                                                },
                                                "tags": {
                                                  "type": "array"
                                                },
                                                "validationResults": {
                                                  "type": "array"
                                                },
                                                "plans": {
                                                  "type": "array",
                                                  "items": {
                                                    "type": "object",
                                                    "properties": {
                                                      "planId": {
                                                        "type": "string"
                                                      }
                                                    },
                                                    "required": [
                                                      "planId"
                                                    ]
                                                  }
                                                },
                                                "triggerInfo": {
                                                  "type": "object",
                                                  "properties": {
                                                    "pr.number": {
                                                      "type": "string"
                                                    },
                                                    "pr.isFork": {
                                                      "type": "string"
                                                    },
                                                    "pr.triggerRepository": {
                                                      "type": "string"
                                                    },
                                                    "pr.triggerRepository.Type": {
                                                      "type": "string"
                                                    }
                                                  }
                                                },
                                                "id": {
                                                  "type": "integer"
                                                },
                                                "buildNumber": {
                                                  "type": "string"
                                                },
                                                "status": {
                                                  "type": "string"
                                                },
                                                "result": {
                                                  "type": "string"
                                                },
                                                "queueTime": {
                                                  "type": "string"
                                                },
                                                "startTime": {
                                                  "type": "string"
                                                },
                                                "finishTime": {
                                                  "type": "string"
                                                },
                                                "url": {
                                                  "type": "string"
                                                },
                                                "definition": {
                                                  "type": "object",
                                                  "properties": {
                                                    "drafts": {
                                                      "type": "array"
                                                    },
                                                    "id": {
                                                      "type": "integer"
                                                    },
                                                    "name": {
                                                      "type": "string"
                                                    },
                                                    "url": {
                                                      "type": "string"
                                                    },
                                                    "uri": {
                                                      "type": "string"
                                                    },
                                                    "path": {
                                                      "type": "string"
                                                    },
                                                    "type": {
                                                      "type": "string"
                                                    },
                                                    "queueStatus": {
                                                      "type": "string"
                                                    },
                                                    "revision": {
                                                      "type": "integer"
                                                    },
                                                    "project": {
                                                      "type": "object",
                                                      "properties": {
                                                        "id": {
                                                          "type": "string"
                                                        },
                                                        "name": {
                                                          "type": "string"
                                                        },
                                                        "description": {
                                                          "type": "string"
                                                        },
                                                        "url": {
                                                          "type": "string"
                                                        },
                                                        "state": {
                                                          "type": "string"
                                                        },
                                                        "revision": {
                                                          "type": "integer"
                                                        },
                                                        "visibility": {
                                                          "type": "string"
                                                        },
                                                        "lastUpdateTime": {
                                                          "type": "string"
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                "buildNumberRevision": {
                                                  "type": "integer"
                                                },
                                                "project": {
                                                  "type": "object",
                                                  "properties": {
                                                    "id": {
                                                      "type": "string"
                                                    },
                                                    "name": {
                                                      "type": "string"
                                                    },
                                                    "description": {
                                                      "type": "string"
                                                    },
                                                    "url": {
                                                      "type": "string"
                                                    },
                                                    "state": {
                                                      "type": "string"
                                                    },
                                                    "revision": {
                                                      "type": "integer"
                                                    },
                                                    "visibility": {
                                                      "type": "string"
                                                    },
                                                    "lastUpdateTime": {
                                                      "type": "string"
                                                    }
                                                  }
                                                },
                                                "uri": {
                                                  "type": "string"
                                                },
                                                "sourceBranch": {
                                                  "type": "string"
                                                },
                                                "sourceVersion": {
                                                  "type": "string"
                                                },
                                                "queue": {
                                                  "type": "object",
                                                  "properties": {
                                                    "id": {
                                                      "type": "integer"
                                                    },
                                                    "name": {
                                                      "type": "string"
                                                    },
                                                    "pool": {
                                                      "type": "object",
                                                      "properties": {
                                                        "id": {
                                                          "type": "integer"
                                                        },
                                                        "name": {
                                                          "type": "string"
                                                        },
                                                        "isHosted": {
                                                          "type": "boolean"
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                "priority": {
                                                  "type": "string"
                                                },
                                                "reason": {
                                                  "type": "string"
                                                },
                                                "requestedFor": {
                                                  "type": "object",
                                                  "properties": {
                                                    "displayName": {
                                                      "type": "string"
                                                    },
                                                    "url": {
                                                      "type": "string"
                                                    },
                                                    "_links": {
                                                      "type": "object",
                                                      "properties": {
                                                        "avatar": {
                                                          "type": "object",
                                                          "properties": {
                                                            "href": {
                                                              "type": "string"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "id": {
                                                      "type": "string"
                                                    },
                                                    "uniqueName": {
                                                      "type": "string"
                                                    },
                                                    "imageUrl": {
                                                      "type": "string"
                                                    },
                                                    "descriptor": {
                                                      "type": "string"
                                                    }
                                                  }
                                                },
                                                "requestedBy": {
                                                  "type": "object",
                                                  "properties": {
                                                    "displayName": {
                                                      "type": "string"
                                                    },
                                                    "url": {
                                                      "type": "string"
                                                    },
                                                    "_links": {
                                                      "type": "object",
                                                      "properties": {
                                                        "avatar": {
                                                          "type": "object",
                                                          "properties": {
                                                            "href": {
                                                              "type": "string"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "id": {
                                                      "type": "string"
                                                    },
                                                    "uniqueName": {
                                                      "type": "string"
                                                    },
                                                    "imageUrl": {
                                                      "type": "string"
                                                    },
                                                    "descriptor": {
                                                      "type": "string"
                                                    }
                                                  }
                                                },
                                                "lastChangedDate": {
                                                  "type": "string"
                                                },
                                                "lastChangedBy": {
                                                  "type": "object",
                                                  "properties": {
                                                    "displayName": {
                                                      "type": "string"
                                                    },
                                                    "url": {
                                                      "type": "string"
                                                    },
                                                    "_links": {
                                                      "type": "object",
                                                      "properties": {
                                                        "avatar": {
                                                          "type": "object",
                                                          "properties": {
                                                            "href": {
                                                              "type": "string"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "id": {
                                                      "type": "string"
                                                    },
                                                    "uniqueName": {
                                                      "type": "string"
                                                    },
                                                    "imageUrl": {
                                                      "type": "string"
                                                    },
                                                    "descriptor": {
                                                      "type": "string"
                                                    }
                                                  }
                                                },
                                                "parameters": {
                                                  "type": "string"
                                                },
                                                "orchestrationPlan": {
                                                  "type": "object",
                                                  "properties": {
                                                    "planId": {
                                                      "type": "string"
                                                    }
                                                  }
                                                },
                                                "logs": {
                                                  "type": "object",
                                                  "properties": {
                                                    "id": {
                                                      "type": "integer"
                                                    },
                                                    "type": {
                                                      "type": "string"
                                                    },
                                                    "url": {
                                                      "type": "string"
                                                    }
                                                  }
                                                },
                                                "repository": {
                                                  "type": "object",
                                                  "properties": {
                                                    "id": {
                                                      "type": "string"
                                                    },
                                                    "type": {
                                                      "type": "string"
                                                    },
                                                    "name": {
                                                      "type": "string"
                                                    },
                                                    "url": {
                                                      "type": "string"
                                                    },
                                                    "clean": {},
                                                    "checkoutSubmodules": {
                                                      "type": "boolean"
                                                    }
                                                  }
                                                },
                                                "retainedByRelease": {
                                                  "type": "boolean"
                                                },
                                                "appendCommitMessageToRunName": {
                                                  "type": "boolean"
                                                }
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Get_Build_Infos": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Compose_ArtificatId": {
                                          "type": "Compose",
                                          "inputs": "@concat('vstfs:///CodeReview/CodeReviewId/',body('Parse_JSON_Get_Build_Infos')?['definition']?['project']?['id'],'/',body('Parse_JSON_Get_Build_Infos')?['triggerInfo']?['pr.number'])",
                                          "runAfter": {
                                            "Parse_JSON_Get_Build_Infos": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Get_Evaluations": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                              "parameters/Method": "GET",
                                              "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/policy/evaluations?artifactId=@{outputs('Compose_ArtificatId')}&top=1&api-version=7.2-preview.1"
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                              "operationId": "HttpRequest",
                                              "connectionName": "shared_visualstudioteamservices"
                                            }
                                          },
                                          "runAfter": {
                                            "Compose_ArtificatId": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Parse_Evaluations": {
                                          "type": "ParseJson",
                                          "inputs": {
                                            "content": "@body('Get_Evaluations')",
                                            "schema": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "array",
                                                  "items": {
                                                    "type": "object",
                                                    "properties": {
                                                      "configuration": {
                                                        "type": "object",
                                                        "properties": {
                                                          "createdBy": {
                                                            "type": "object",
                                                            "properties": {
                                                              "displayName": {
                                                                "type": "string"
                                                              },
                                                              "url": {
                                                                "type": "string"
                                                              },
                                                              "_links": {
                                                                "type": "object",
                                                                "properties": {
                                                                  "avatar": {
                                                                    "type": "object",
                                                                    "properties": {
                                                                      "href": {
                                                                        "type": "string"
                                                                      }
                                                                    }
                                                                  }
                                                                }
                                                              },
                                                              "id": {
                                                                "type": "string"
                                                              },
                                                              "uniqueName": {
                                                                "type": "string"
                                                              },
                                                              "imageUrl": {
                                                                "type": "string"
                                                              },
                                                              "descriptor": {
                                                                "type": "string"
                                                              }
                                                            }
                                                          },
                                                          "createdDate": {
                                                            "type": "string"
                                                          },
                                                          "isEnabled": {
                                                            "type": "boolean"
                                                          },
                                                          "isBlocking": {
                                                            "type": "boolean"
                                                          },
                                                          "isDeleted": {
                                                            "type": "boolean"
                                                          },
                                                          "settings": {
                                                            "type": "object",
                                                            "properties": {
                                                              "buildDefinitionId": {
                                                                "type": "integer"
                                                              },
                                                              "queueOnSourceUpdateOnly": {
                                                                "type": "boolean"
                                                              },
                                                              "manualQueueOnly": {
                                                                "type": "boolean"
                                                              },
                                                              "displayName": {
                                                                "type": "string"
                                                              },
                                                              "validDuration": {
                                                                "type": "integer"
                                                              },
                                                              "scope": {
                                                                "type": "array",
                                                                "items": {
                                                                  "type": "object",
                                                                  "properties": {
                                                                    "refName": {
                                                                      "type": "string"
                                                                    },
                                                                    "matchKind": {
                                                                      "type": "string"
                                                                    },
                                                                    "repositoryId": {
                                                                      "type": "string"
                                                                    }
                                                                  },
                                                                  "required": [
                                                                    "refName",
                                                                    "matchKind",
                                                                    "repositoryId"
                                                                  ]
                                                                }
                                                              },
                                                              "filenamePatterns": {
                                                                "type": "array",
                                                                "items": {
                                                                  "type": "string"
                                                                }
                                                              }
                                                            }
                                                          },
                                                          "isEnterpriseManaged": {
                                                            "type": "boolean"
                                                          },
                                                          "_links": {
                                                            "type": "object",
                                                            "properties": {
                                                              "self": {
                                                                "type": "object",
                                                                "properties": {
                                                                  "href": {
                                                                    "type": "string"
                                                                  }
                                                                }
                                                              },
                                                              "policyType": {
                                                                "type": "object",
                                                                "properties": {
                                                                  "href": {
                                                                    "type": "string"
                                                                  }
                                                                }
                                                              }
                                                            }
                                                          },
                                                          "revision": {
                                                            "type": "integer"
                                                          },
                                                          "id": {
                                                            "type": "integer"
                                                          },
                                                          "url": {
                                                            "type": "string"
                                                          },
                                                          "type": {
                                                            "type": "object",
                                                            "properties": {
                                                              "id": {
                                                                "type": "string"
                                                              },
                                                              "url": {
                                                                "type": "string"
                                                              },
                                                              "displayName": {
                                                                "type": "string"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "artifactId": {
                                                        "type": "string"
                                                      },
                                                      "evaluationId": {
                                                        "type": "string"
                                                      },
                                                      "startedDate": {
                                                        "type": "string"
                                                      },
                                                      "completedDate": {
                                                        "type": "string"
                                                      },
                                                      "status": {
                                                        "type": "string"
                                                      },
                                                      "context": {
                                                        "type": "object",
                                                        "properties": {
                                                          "lastMergeCommitId": {
                                                            "type": "string"
                                                          },
                                                          "lastMergeSourceCommitId": {
                                                            "type": "string"
                                                          },
                                                          "lastMergeTargetCommitId": {
                                                            "type": "string"
                                                          },
                                                          "buildId": {
                                                            "type": "integer"
                                                          },
                                                          "buildDefinitionId": {
                                                            "type": "integer"
                                                          },
                                                          "buildDefinitionName": {
                                                            "type": "string"
                                                          },
                                                          "buildIsNotCurrent": {
                                                            "type": "boolean"
                                                          },
                                                          "buildStartedUtc": {
                                                            "type": "string"
                                                          },
                                                          "isExpired": {
                                                            "type": "boolean"
                                                          },
                                                          "buildAfterMerge": {
                                                            "type": "boolean"
                                                          },
                                                          "wasAutoRequeued": {
                                                            "type": "boolean"
                                                          },
                                                          "buildOutputPreview": {}
                                                        }
                                                      }
                                                    },
                                                    "required": [
                                                      "configuration",
                                                      "artifactId",
                                                      "evaluationId",
                                                      "startedDate",
                                                      "completedDate",
                                                      "status",
                                                      "context"
                                                    ]
                                                  }
                                                },
                                                "count": {
                                                  "type": "integer"
                                                }
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Get_Evaluations": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "For_each_10": {
                                          "type": "Foreach",
                                          "foreach": "@outputs('Parse_Evaluations')?['body']?['value']",
                                          "actions": {
                                            "Requeue_build": {
                                              "type": "OpenApiConnection",
                                              "inputs": {
                                                "parameters": {
                                                  "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                                  "parameters/Method": "PATCH",
                                                  "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/policy/evaluations/@{item()?['evaluationId']}?api-version=7.2-preview.1"
                                                },
                                                "host": {
                                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                                  "operationId": "HttpRequest",
                                                  "connectionName": "shared_visualstudioteamservices"
                                                }
                                              }
                                            },
                                            "Parse_JSON_requeue_build": {
                                              "type": "ParseJson",
                                              "inputs": {
                                                "content": "@body('Requeue_build')",
                                                "schema": {
                                                  "type": "object",
                                                  "properties": {
                                                    "configuration": {
                                                      "type": "object",
                                                      "properties": {
                                                        "createdBy": {
                                                          "type": "object",
                                                          "properties": {
                                                            "displayName": {
                                                              "type": "string"
                                                            },
                                                            "url": {
                                                              "type": "string"
                                                            },
                                                            "_links": {
                                                              "type": "object",
                                                              "properties": {
                                                                "avatar": {
                                                                  "type": "object",
                                                                  "properties": {
                                                                    "href": {
                                                                      "type": "string"
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            },
                                                            "id": {
                                                              "type": "string"
                                                            },
                                                            "uniqueName": {
                                                              "type": "string"
                                                            },
                                                            "imageUrl": {
                                                              "type": "string"
                                                            },
                                                            "descriptor": {
                                                              "type": "string"
                                                            }
                                                          }
                                                        },
                                                        "createdDate": {
                                                          "type": "string"
                                                        },
                                                        "isEnabled": {
                                                          "type": "boolean"
                                                        },
                                                        "isBlocking": {
                                                          "type": "boolean"
                                                        },
                                                        "isDeleted": {
                                                          "type": "boolean"
                                                        },
                                                        "settings": {
                                                          "type": "object",
                                                          "properties": {
                                                            "buildDefinitionId": {
                                                              "type": "integer"
                                                            },
                                                            "queueOnSourceUpdateOnly": {
                                                              "type": "boolean"
                                                            },
                                                            "manualQueueOnly": {
                                                              "type": "boolean"
                                                            },
                                                            "displayName": {
                                                              "type": "string"
                                                            },
                                                            "validDuration": {
                                                              "type": "integer"
                                                            },
                                                            "scope": {
                                                              "type": "array",
                                                              "items": {
                                                                "type": "object",
                                                                "properties": {
                                                                  "refName": {
                                                                    "type": "string"
                                                                  },
                                                                  "matchKind": {
                                                                    "type": "string"
                                                                  },
                                                                  "repositoryId": {
                                                                    "type": "string"
                                                                  }
                                                                },
                                                                "required": [
                                                                  "refName",
                                                                  "matchKind",
                                                                  "repositoryId"
                                                                ]
                                                              }
                                                            },
                                                            "filenamePatterns": {
                                                              "type": "array",
                                                              "items": {
                                                                "type": "string"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        "isEnterpriseManaged": {
                                                          "type": "boolean"
                                                        },
                                                        "_links": {
                                                          "type": "object",
                                                          "properties": {
                                                            "self": {
                                                              "type": "object",
                                                              "properties": {
                                                                "href": {
                                                                  "type": "string"
                                                                }
                                                              }
                                                            },
                                                            "policyType": {
                                                              "type": "object",
                                                              "properties": {
                                                                "href": {
                                                                  "type": "string"
                                                                }
                                                              }
                                                            }
                                                          }
                                                        },
                                                        "revision": {
                                                          "type": "integer"
                                                        },
                                                        "id": {
                                                          "type": "integer"
                                                        },
                                                        "url": {
                                                          "type": "string"
                                                        },
                                                        "type": {
                                                          "type": "object",
                                                          "properties": {
                                                            "id": {
                                                              "type": "string"
                                                            },
                                                            "url": {
                                                              "type": "string"
                                                            },
                                                            "displayName": {
                                                              "type": "string"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "artifactId": {
                                                      "type": "string"
                                                    },
                                                    "evaluationId": {
                                                      "type": "string"
                                                    },
                                                    "startedDate": {
                                                      "type": "string"
                                                    },
                                                    "status": {
                                                      "type": "string"
                                                    },
                                                    "context": {
                                                      "type": "object",
                                                      "properties": {
                                                        "lastMergeCommitId": {
                                                          "type": "string"
                                                        },
                                                        "lastMergeSourceCommitId": {
                                                          "type": "string"
                                                        },
                                                        "lastMergeTargetCommitId": {
                                                          "type": "string"
                                                        },
                                                        "buildId": {
                                                          "type": "integer"
                                                        },
                                                        "buildDefinitionId": {
                                                          "type": "integer"
                                                        },
                                                        "buildDefinitionName": {
                                                          "type": "string"
                                                        },
                                                        "buildIsNotCurrent": {
                                                          "type": "boolean"
                                                        },
                                                        "buildStartedUtc": {
                                                          "type": "string"
                                                        },
                                                        "isExpired": {
                                                          "type": "boolean"
                                                        },
                                                        "buildAfterMerge": {
                                                          "type": "boolean"
                                                        },
                                                        "wasAutoRequeued": {
                                                          "type": "boolean"
                                                        },
                                                        "buildOutputPreview": {}
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "Requeue_build": [
                                                  "Succeeded"
                                                ]
                                              }
                                            },
                                            "Set_variable_25": {
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "buildId",
                                                "value": "@string(body('Parse_JSON_requeue_build')?['context']?['buildId'])"
                                              },
                                              "runAfter": {
                                                "Parse_JSON_requeue_build": [
                                                  "Succeeded"
                                                ]
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Parse_Evaluations": [
                                              "Succeeded"
                                            ]
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {}
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Condition_4": {
                                        "type": "If",
                                        "expression": {
                                          "and": [
                                            {
                                              "equals": [
                                                "@variables('sentEmail')",
                                                false
                                              ]
                                            }
                                          ]
                                        },
                                        "actions": {
                                          "Send_an_email_(V2)_1": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "emailMessage/To": "@parameters('ALM_DLToNotify (dyna_ALM_DLToNotify)')",
                                                "emailMessage/Subject": "DevOps Error Automation ALM Accelerator",
                                                "emailMessage/Body": "<p class=\"editor-paragraph\">Orga DevOps : @{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}</p><p class=\"editor-paragraph\">Project DevOps : @{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">Solution : @{triggerBody()?['text_1']}</p><p class=\"editor-paragraph\">Type : <u><b><strong class=\"editor-text-bold editor-text-underline\">Deploy Validation</strong></b></u></p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">Build Link : @{concat(variables('linkDevOps'),variables('buildId'))}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">----------------------------------------------------------------------------------</p><br><p class=\"editor-paragraph\">@{body('Get_specific_log_by_id_1')}</p>",
                                                "emailMessage/Importance": "High"
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365",
                                                "operationId": "SendEmailV2",
                                                "connectionName": "shared_office365"
                                              }
                                            },
                                            "runAfter": {
                                              "Delete_source_branch": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_26": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "sentEmail",
                                              "value": true
                                            },
                                            "runAfter": {
                                              "Send_an_email_(V2)_1": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_12": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "GoOnOrNot",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_26": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_11": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "DoUntilBooleanLoop",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_12": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Update_Log_6": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "entityName": "dyna_almtrackinghistories",
                                                "recordId": "@body('Add_a_new_Log_Validation')?['dyna_almtrackinghistoryid']",
                                                "item/dyna_name": "Deploy Validation",
                                                "item/dyna_enddatetime": "@utcNow()",
                                                "item/statuscode": 538000001
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                                "operationId": "UpdateRecord",
                                                "connectionName": "shared_commondataserviceforapps"
                                              }
                                            },
                                            "runAfter": {
                                              "Set_variable_11": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Get_DevOps_PR": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                                "parameters/Method": "GET",
                                                "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}?api-version=7.1-preview.7"
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                                "operationId": "HttpRequest",
                                                "connectionName": "shared_visualstudioteamservices"
                                              }
                                            }
                                          },
                                          "Parse_JSON_Get_DevOps_PR": {
                                            "type": "ParseJson",
                                            "inputs": {
                                              "content": "@body('Get_DevOps_PR')",
                                              "schema": {
                                                "type": "object",
                                                "properties": {
                                                  "_links": {
                                                    "type": "object",
                                                    "properties": {
                                                      "self": {
                                                        "type": "object",
                                                        "properties": {
                                                          "href": {
                                                            "type": "string"
                                                          }
                                                        }
                                                      },
                                                      "web": {
                                                        "type": "object",
                                                        "properties": {
                                                          "href": {
                                                            "type": "string"
                                                          }
                                                        }
                                                      },
                                                      "sourceVersionDisplayUri": {
                                                        "type": "object",
                                                        "properties": {
                                                          "href": {
                                                            "type": "string"
                                                          }
                                                        }
                                                      },
                                                      "timeline": {
                                                        "type": "object",
                                                        "properties": {
                                                          "href": {
                                                            "type": "string"
                                                          }
                                                        }
                                                      },
                                                      "badge": {
                                                        "type": "object",
                                                        "properties": {
                                                          "href": {
                                                            "type": "string"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "properties": {
                                                    "type": "object"
                                                  },
                                                  "tags": {
                                                    "type": "array"
                                                  },
                                                  "validationResults": {
                                                    "type": "array"
                                                  },
                                                  "plans": {
                                                    "type": "array",
                                                    "items": {
                                                      "type": "object",
                                                      "properties": {
                                                        "planId": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "required": [
                                                        "planId"
                                                      ]
                                                    }
                                                  },
                                                  "triggerInfo": {
                                                    "type": "object",
                                                    "properties": {
                                                      "pr.number": {
                                                        "type": "string"
                                                      },
                                                      "pr.isFork": {
                                                        "type": "string"
                                                      },
                                                      "pr.triggerRepository": {
                                                        "type": "string"
                                                      },
                                                      "pr.triggerRepository.Type": {
                                                        "type": "string"
                                                      }
                                                    }
                                                  },
                                                  "id": {
                                                    "type": "integer"
                                                  },
                                                  "buildNumber": {
                                                    "type": "string"
                                                  },
                                                  "status": {
                                                    "type": "string"
                                                  },
                                                  "result": {
                                                    "type": "string"
                                                  },
                                                  "queueTime": {
                                                    "type": "string"
                                                  },
                                                  "startTime": {
                                                    "type": "string"
                                                  },
                                                  "finishTime": {
                                                    "type": "string"
                                                  },
                                                  "url": {
                                                    "type": "string"
                                                  },
                                                  "definition": {
                                                    "type": "object",
                                                    "properties": {
                                                      "drafts": {
                                                        "type": "array"
                                                      },
                                                      "id": {
                                                        "type": "integer"
                                                      },
                                                      "name": {
                                                        "type": "string"
                                                      },
                                                      "url": {
                                                        "type": "string"
                                                      },
                                                      "uri": {
                                                        "type": "string"
                                                      },
                                                      "path": {
                                                        "type": "string"
                                                      },
                                                      "type": {
                                                        "type": "string"
                                                      },
                                                      "queueStatus": {
                                                        "type": "string"
                                                      },
                                                      "revision": {
                                                        "type": "integer"
                                                      },
                                                      "project": {
                                                        "type": "object",
                                                        "properties": {
                                                          "id": {
                                                            "type": "string"
                                                          },
                                                          "name": {
                                                            "type": "string"
                                                          },
                                                          "description": {
                                                            "type": "string"
                                                          },
                                                          "url": {
                                                            "type": "string"
                                                          },
                                                          "state": {
                                                            "type": "string"
                                                          },
                                                          "revision": {
                                                            "type": "integer"
                                                          },
                                                          "visibility": {
                                                            "type": "string"
                                                          },
                                                          "lastUpdateTime": {
                                                            "type": "string"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "buildNumberRevision": {
                                                    "type": "integer"
                                                  },
                                                  "project": {
                                                    "type": "object",
                                                    "properties": {
                                                      "id": {
                                                        "type": "string"
                                                      },
                                                      "name": {
                                                        "type": "string"
                                                      },
                                                      "description": {
                                                        "type": "string"
                                                      },
                                                      "url": {
                                                        "type": "string"
                                                      },
                                                      "state": {
                                                        "type": "string"
                                                      },
                                                      "revision": {
                                                        "type": "integer"
                                                      },
                                                      "visibility": {
                                                        "type": "string"
                                                      },
                                                      "lastUpdateTime": {
                                                        "type": "string"
                                                      }
                                                    }
                                                  },
                                                  "uri": {
                                                    "type": "string"
                                                  },
                                                  "sourceBranch": {
                                                    "type": "string"
                                                  },
                                                  "sourceVersion": {
                                                    "type": "string"
                                                  },
                                                  "queue": {
                                                    "type": "object",
                                                    "properties": {
                                                      "id": {
                                                        "type": "integer"
                                                      },
                                                      "name": {
                                                        "type": "string"
                                                      },
                                                      "pool": {
                                                        "type": "object",
                                                        "properties": {
                                                          "id": {
                                                            "type": "integer"
                                                          },
                                                          "name": {
                                                            "type": "string"
                                                          },
                                                          "isHosted": {
                                                            "type": "boolean"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "priority": {
                                                    "type": "string"
                                                  },
                                                  "reason": {
                                                    "type": "string"
                                                  },
                                                  "requestedFor": {
                                                    "type": "object",
                                                    "properties": {
                                                      "displayName": {
                                                        "type": "string"
                                                      },
                                                      "url": {
                                                        "type": "string"
                                                      },
                                                      "_links": {
                                                        "type": "object",
                                                        "properties": {
                                                          "avatar": {
                                                            "type": "object",
                                                            "properties": {
                                                              "href": {
                                                                "type": "string"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "id": {
                                                        "type": "string"
                                                      },
                                                      "uniqueName": {
                                                        "type": "string"
                                                      },
                                                      "imageUrl": {
                                                        "type": "string"
                                                      },
                                                      "descriptor": {
                                                        "type": "string"
                                                      }
                                                    }
                                                  },
                                                  "requestedBy": {
                                                    "type": "object",
                                                    "properties": {
                                                      "displayName": {
                                                        "type": "string"
                                                      },
                                                      "url": {
                                                        "type": "string"
                                                      },
                                                      "_links": {
                                                        "type": "object",
                                                        "properties": {
                                                          "avatar": {
                                                            "type": "object",
                                                            "properties": {
                                                              "href": {
                                                                "type": "string"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "id": {
                                                        "type": "string"
                                                      },
                                                      "uniqueName": {
                                                        "type": "string"
                                                      },
                                                      "imageUrl": {
                                                        "type": "string"
                                                      },
                                                      "descriptor": {
                                                        "type": "string"
                                                      }
                                                    }
                                                  },
                                                  "lastChangedDate": {
                                                    "type": "string"
                                                  },
                                                  "lastChangedBy": {
                                                    "type": "object",
                                                    "properties": {
                                                      "displayName": {
                                                        "type": "string"
                                                      },
                                                      "url": {
                                                        "type": "string"
                                                      },
                                                      "_links": {
                                                        "type": "object",
                                                        "properties": {
                                                          "avatar": {
                                                            "type": "object",
                                                            "properties": {
                                                              "href": {
                                                                "type": "string"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "id": {
                                                        "type": "string"
                                                      },
                                                      "uniqueName": {
                                                        "type": "string"
                                                      },
                                                      "imageUrl": {
                                                        "type": "string"
                                                      },
                                                      "descriptor": {
                                                        "type": "string"
                                                      }
                                                    }
                                                  },
                                                  "parameters": {
                                                    "type": "string"
                                                  },
                                                  "orchestrationPlan": {
                                                    "type": "object",
                                                    "properties": {
                                                      "planId": {
                                                        "type": "string"
                                                      }
                                                    }
                                                  },
                                                  "logs": {
                                                    "type": "object",
                                                    "properties": {
                                                      "id": {
                                                        "type": "integer"
                                                      },
                                                      "type": {
                                                        "type": "string"
                                                      },
                                                      "url": {
                                                        "type": "string"
                                                      }
                                                    }
                                                  },
                                                  "repository": {
                                                    "type": "object",
                                                    "properties": {
                                                      "id": {
                                                        "type": "string"
                                                      },
                                                      "type": {
                                                        "type": "string"
                                                      },
                                                      "name": {
                                                        "type": "string"
                                                      },
                                                      "url": {
                                                        "type": "string"
                                                      },
                                                      "clean": {},
                                                      "checkoutSubmodules": {
                                                        "type": "boolean"
                                                      }
                                                    }
                                                  },
                                                  "retainedByRelease": {
                                                    "type": "boolean"
                                                  },
                                                  "appendCommitMessageToRunName": {
                                                    "type": "boolean"
                                                  }
                                                }
                                              }
                                            },
                                            "runAfter": {
                                              "Get_DevOps_PR": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Update_PR_to_abandon": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                                "parameters/Method": "PATCH",
                                                "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/git/repositories/@{parameters('ALM_DevOps_RepositoryID (dyna_almdevopsrepositoryid)')}/pullrequests/@{body('Parse_JSON_Get_DevOps_PR')?['triggerInfo']?['pr.number']}?api-version=7.2-preview.2",
                                                "parameters/Body": "{\"status\":\"abandoned\",\n\"description\": \"Validation Errors even after multiple retry. Cancel automatically from Automation ALM\",\n  \"completionOptions\": {\n    \"deleteSourceBranch\": true\n  }\n}"
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                                "operationId": "HttpRequest",
                                                "connectionName": "shared_visualstudioteamservices"
                                              }
                                            },
                                            "runAfter": {
                                              "Parse_JSON_Get_DevOps_PR": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Delete_source_branch": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                                "parameters/Method": "POST",
                                                "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/git/repositories/@{parameters('ALM_DevOps_RepositoryID (dyna_almdevopsrepositoryid)')}/refs?api-version=7.0",
                                                "parameters/Body": "[\n  {\n    \"name\": \"refs/heads/@{concat(triggerBody()?['text_1'],'_',formatDateTime(utcNow(),'ddMMyy'))}\",\n    \"oldObjectId\": \"0000000000000000000000000000000000000000\",\n    \"newObjectId\": \"0000000000000000000000000000000000000000\"\n  }\n]"
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                                "operationId": "HttpRequest",
                                                "connectionName": "shared_visualstudioteamservices"
                                              }
                                            },
                                            "runAfter": {
                                              "Update_PR_to_abandon": [
                                                "Succeeded"
                                              ]
                                            }
                                          }
                                        },
                                        "else": {
                                          "actions": {}
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "actions": {}
                              },
                              "runAfter": {
                                "Get_specific_log_by_id_1": [
                                  "Succeeded"
                                ]
                              }
                            }
                          },
                          "runAfter": {
                            "Set_RetryBool_1": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_RetryBool_1": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "RetryBool",
                            "value": false
                          },
                          "runAfter": {
                            "Parse_All_Logs_1": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "failed"
                    }
                  },
                  "runAfter": {
                    "CurrentStatus_1": [
                      "Succeeded"
                    ]
                  }
                }
              },
              "runAfter": {
                "Add_a_new_Log_Validation": [
                  "Succeeded"
                ]
              }
            },
            "Add_a_new_Log_Validation": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "dyna_almtrackinghistories",
                  "item/dyna_name": "Deploy Validation",
                  "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                  "item/dyna_buildid": "@variables('buildId')",
                  "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{variables('buildId')}&view=results",
                  "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                  "item/dyna_startdatetime": "@utcNow()",
                  "item/statuscode": 538000003
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "connectionName": "shared_commondataserviceforapps"
                }
              },
              "runAfter": {
                "Search_for_Build_id_Validation": [
                  "Succeeded"
                ]
              }
            }
          },
          "else": {
            "actions": {}
          },
          "runAfter": {
            "QA_Only_-_Check_1st_Stage_of_Export": [
              "Succeeded"
            ]
          }
        },
        "Initialize_GoOnOrNot": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "GoOnOrNot",
                "type": "boolean",
                "value": true
              }
            ]
          },
          "runAfter": {
            "Initialize_DoUntilBooleanLoop": [
              "Succeeded"
            ]
          }
        },
        "Initialize_pipelineId": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "pipelineId",
                "type": "integer"
              }
            ]
          },
          "runAfter": {
            "Initialize_GoOnOrNot": [
              "Succeeded"
            ]
          }
        },
        "QA_Only_-_3rd_Stage_Test": {
          "type": "If",
          "expression": {
            "and": [
              {
                "equals": [
                  "@triggerBody()?['text_2']",
                  "QA"
                ]
              },
              {
                "equals": [
                  "@variables('GoOnOrNot')",
                  true
                ]
              }
            ]
          },
          "actions": {
            "Reinit_variables_1": {
              "type": "Scope",
              "actions": {
                "ReInitialize_DoUntilBooleanLoop_1": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "DoUntilBooleanLoop",
                    "value": true
                  }
                },
                "ReInitialize_GoOnOrNot_1": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "GoOnOrNot",
                    "value": true
                  },
                  "runAfter": {
                    "ReInitialize_DoUntilBooleanLoop_1": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_sentEmail_2": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "sentEmail",
                    "value": false
                  },
                  "runAfter": {
                    "ReInitialize_GoOnOrNot_1": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_RetryBool_2": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "RetryBool",
                    "value": false
                  },
                  "runAfter": {
                    "Reinit_sentEmail_2": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_Retry_2": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "Retry",
                    "value": 0
                  },
                  "runAfter": {
                    "Reinit_RetryBool_2": [
                      "Succeeded"
                    ]
                  }
                }
              }
            },
            "Delay_1min_waiting_for_the_build_to_run": {
              "type": "Wait",
              "inputs": {
                "interval": {
                  "count": 1,
                  "unit": "Minute"
                }
              },
              "runAfter": {
                "Reinit_variables_1": [
                  "Succeeded"
                ]
              }
            },
            "Search_for_Build_id_Test": {
              "type": "Scope",
              "actions": {
                "List_pipelines_1": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "project": "@parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "ListPipelines",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  }
                },
                "For_each_4": {
                  "type": "Foreach",
                  "foreach": "@outputs('List_pipelines_1')?['body/value']",
                  "actions": {
                    "Condition_1": {
                      "type": "If",
                      "expression": {
                        "and": [
                          {
                            "contains": [
                              "@item()?['name']",
                              "deploy-test-@{triggerBody()?['text_1']}"
                            ]
                          }
                        ]
                      },
                      "actions": {
                        "Set_variable_7": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "pipelineId",
                            "value": "@item()?['id']"
                          }
                        }
                      },
                      "else": {
                        "actions": {}
                      }
                    }
                  },
                  "runAfter": {
                    "List_pipelines_1": [
                      "Succeeded"
                    ]
                  }
                },
                "Search_BuildId_1": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "parameters/Method": "GET",
                      "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds?definitions=@{variables('pipelineId')}&maxBuildsPerDefinition=1&queryOrder=queueTimeDescending"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "HttpRequest",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  },
                  "runAfter": {
                    "For_each_4": [
                      "Succeeded"
                    ]
                  }
                },
                "Parse_JSON_BuildId_1": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@body('Search_BuildId_1')",
                    "schema": {
                      "type": "object",
                      "properties": {
                        "count": {
                          "type": "integer"
                        },
                        "value": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "_links": {
                                "type": "object",
                                "properties": {
                                  "self": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "web": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "sourceVersionDisplayUri": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "timeline": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "badge": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                }
                              },
                              "properties": {
                                "type": "object",
                                "properties": {}
                              },
                              "tags": {
                                "type": "array"
                              },
                              "validationResults": {
                                "type": "array"
                              },
                              "plans": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "planId": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "planId"
                                  ]
                                }
                              },
                              "triggerInfo": {
                                "type": "object",
                                "properties": {
                                  "ci.sourceBranch": {
                                    "type": "string"
                                  },
                                  "ci.sourceSha": {
                                    "type": "string"
                                  },
                                  "ci.message": {
                                    "type": "string"
                                  },
                                  "ci.triggerRepository": {
                                    "type": "string"
                                  }
                                }
                              },
                              "id": {
                                "type": "integer"
                              },
                              "buildNumber": {
                                "type": "string"
                              },
                              "status": {
                                "type": "string"
                              },
                              "queueTime": {
                                "type": "string"
                              },
                              "startTime": {
                                "type": "string"
                              },
                              "url": {
                                "type": "string"
                              },
                              "definition": {
                                "type": "object",
                                "properties": {
                                  "drafts": {
                                    "type": "array"
                                  },
                                  "id": {
                                    "type": "integer"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "uri": {
                                    "type": "string"
                                  },
                                  "path": {
                                    "type": "string"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "queueStatus": {
                                    "type": "string"
                                  },
                                  "revision": {
                                    "type": "integer"
                                  },
                                  "project": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "description": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      },
                                      "state": {
                                        "type": "string"
                                      },
                                      "revision": {
                                        "type": "integer"
                                      },
                                      "visibility": {
                                        "type": "string"
                                      },
                                      "lastUpdateTime": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                }
                              },
                              "buildNumberRevision": {
                                "type": "integer"
                              },
                              "project": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "description": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "state": {
                                    "type": "string"
                                  },
                                  "revision": {
                                    "type": "integer"
                                  },
                                  "visibility": {
                                    "type": "string"
                                  },
                                  "lastUpdateTime": {
                                    "type": "string"
                                  }
                                }
                              },
                              "uri": {
                                "type": "string"
                              },
                              "sourceBranch": {
                                "type": "string"
                              },
                              "sourceVersion": {
                                "type": "string"
                              },
                              "queue": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "pool": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "integer"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "isHosted": {
                                        "type": "boolean"
                                      }
                                    }
                                  }
                                }
                              },
                              "priority": {
                                "type": "string"
                              },
                              "reason": {
                                "type": "string"
                              },
                              "requestedFor": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "requestedBy": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "lastChangedDate": {
                                "type": "string"
                              },
                              "lastChangedBy": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "orchestrationPlan": {
                                "type": "object",
                                "properties": {
                                  "planId": {
                                    "type": "string"
                                  }
                                }
                              },
                              "logs": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  }
                                }
                              },
                              "repository": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "clean": {},
                                  "checkoutSubmodules": {
                                    "type": "boolean"
                                  }
                                }
                              },
                              "retainedByRelease": {
                                "type": "boolean"
                              },
                              "triggeredByBuild": {},
                              "appendCommitMessageToRunName": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "_links",
                              "properties",
                              "tags",
                              "validationResults",
                              "plans",
                              "triggerInfo",
                              "id",
                              "buildNumber",
                              "status",
                              "queueTime",
                              "startTime",
                              "url",
                              "definition",
                              "buildNumberRevision",
                              "project",
                              "uri",
                              "sourceBranch",
                              "sourceVersion",
                              "queue",
                              "priority",
                              "reason",
                              "requestedFor",
                              "requestedBy",
                              "lastChangedDate",
                              "lastChangedBy",
                              "orchestrationPlan",
                              "logs",
                              "repository",
                              "retainedByRelease",
                              "triggeredByBuild",
                              "appendCommitMessageToRunName"
                            ]
                          }
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Search_BuildId_1": [
                      "Succeeded"
                    ]
                  }
                },
                "For_each_5": {
                  "type": "Foreach",
                  "foreach": "@outputs('Parse_JSON_BuildId_1')?['body']?['value']",
                  "actions": {
                    "Set_buildId_for_test_environment": {
                      "type": "SetVariable",
                      "inputs": {
                        "name": "buildId",
                        "value": "@string(item()?['id'])"
                      }
                    }
                  },
                  "runAfter": {
                    "Parse_JSON_BuildId_1": [
                      "Succeeded"
                    ]
                  }
                }
              },
              "runAfter": {
                "Delay_1min_waiting_for_the_build_to_run": [
                  "Succeeded"
                ]
              }
            },
            "Do_until_test": {
              "type": "Until",
              "expression": "@equals(variables('DoUntilBooleanLoop'),false)",
              "limit": {
                "count": 3600,
                "timeout": "PT24H"
              },
              "actions": {
                "Get_Status_of_Export_Git_Build_2": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "parameters/Method": "GET",
                      "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "HttpRequest",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  }
                },
                "Parse_Get_Status_of_Export_Git_Build_2": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@body('Get_Status_of_Export_Git_Build_2')",
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "web": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "sourceVersionDisplayUri": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "timeline": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "badge": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {}
                        },
                        "tags": {
                          "type": "array"
                        },
                        "validationResults": {
                          "type": "array"
                        },
                        "plans": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "planId": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "planId"
                            ]
                          }
                        },
                        "templateParameters": {
                          "type": "object",
                          "properties": {
                            "Branch": {
                              "type": "string"
                            },
                            "BranchToCreate": {
                              "type": "string"
                            },
                            "BuildDefinitionId": {
                              "type": "string"
                            },
                            "CommitMessage": {
                              "type": "string"
                            },
                            "CommitScope": {
                              "type": "string"
                            },
                            "DATA": {
                              "type": "string"
                            },
                            "Email": {
                              "type": "string"
                            },
                            "EnvironmentName": {
                              "type": "string"
                            },
                            "ImportUnmanaged": {
                              "type": "string"
                            },
                            "PipelineId": {
                              "type": "string"
                            },
                            "PortalSiteName": {
                              "type": "string"
                            },
                            "Project": {
                              "type": "string"
                            },
                            "PublishCustomizations": {
                              "type": "string"
                            },
                            "Repo": {
                              "type": "string"
                            },
                            "ServiceConnectionName": {
                              "type": "string"
                            },
                            "ServiceConnectionUrl": {
                              "type": "string"
                            },
                            "SolutionName": {
                              "type": "string"
                            },
                            "UserName": {
                              "type": "string"
                            },
                            "AgentPool": {
                              "type": "string"
                            },
                            "VMImage": {
                              "type": "string"
                            }
                          }
                        },
                        "triggerInfo": {
                          "type": "object",
                          "properties": {}
                        },
                        "id": {
                          "type": "integer"
                        },
                        "buildNumber": {
                          "type": "string"
                        },
                        "Status": {
                          "type": "string"
                        },
                        "result": {
                          "type": "string"
                        },
                        "queueTime": {
                          "type": "string"
                        },
                        "startTime": {
                          "type": "string"
                        },
                        "finishTime": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "definition": {
                          "type": "object",
                          "properties": {
                            "drafts": {
                              "type": "array"
                            },
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "uri": {
                              "type": "string"
                            },
                            "path": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "queueStatus": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "project": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "url": {
                                  "type": "string"
                                },
                                "state": {
                                  "type": "string"
                                },
                                "revision": {
                                  "type": "integer"
                                },
                                "visibility": {
                                  "type": "string"
                                },
                                "lastUpdateTime": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "project": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "description": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "state": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "visibility": {
                              "type": "string"
                            },
                            "lastUpdateTime": {
                              "type": "string"
                            }
                          }
                        },
                        "uri": {
                          "type": "string"
                        },
                        "sourceBranch": {
                          "type": "string"
                        },
                        "sourceVersion": {
                          "type": "string"
                        },
                        "queue": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "pool": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "integer"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "isHosted": {
                                  "type": "boolean"
                                }
                              }
                            }
                          }
                        },
                        "priority": {
                          "type": "string"
                        },
                        "reason": {
                          "type": "string"
                        },
                        "requestedFor": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "requestedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "lastChangedDate": {
                          "type": "string"
                        },
                        "lastChangedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "orchestrationPlan": {
                          "type": "object",
                          "properties": {
                            "planId": {
                              "type": "string"
                            }
                          }
                        },
                        "logs": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "type": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            }
                          }
                        },
                        "repository": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "clean": {},
                            "checkoutSubmodules": {
                              "type": "boolean"
                            }
                          }
                        },
                        "retainedByRelease": {
                          "type": "boolean"
                        },
                        "appendCommitMessageToRunName": {
                          "type": "boolean"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Get_Status_of_Export_Git_Build_2": [
                      "Succeeded"
                    ]
                  }
                },
                "Set_Build_Status_2": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "buildStatus",
                    "value": "@body('Parse_Get_Status_of_Export_Git_Build_2')?['result']"
                  },
                  "runAfter": {
                    "Parse_Get_Status_of_Export_Git_Build_2": [
                      "Succeeded"
                    ]
                  }
                },
                "CurrentStatus_2": {
                  "type": "Compose",
                  "inputs": "@variables('buildStatus')",
                  "runAfter": {
                    "Set_Build_Status_2": [
                      "Succeeded"
                    ]
                  }
                },
                "Switch_2": {
                  "type": "Switch",
                  "expression": "@outputs('CurrentStatus_2')",
                  "default": {
                    "actions": {
                      "Delay_1mn_each_call_2": {
                        "type": "Wait",
                        "inputs": {
                          "interval": {
                            "count": 1,
                            "unit": "Minute"
                          }
                        }
                      }
                    }
                  },
                  "cases": {
                    "Case_Success_2": {
                      "actions": {
                        "Set_variable_41": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_13": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_13": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": true
                          }
                        },
                        "Update_Log_7": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log_Test')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Deploy Test",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 1
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable_41": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "succeeded"
                    },
                    "Case_partiallySucceeded_2": {
                      "actions": {
                        "Set_variable_14": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_15": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_15": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": false
                          }
                        },
                        "Update_Log_8": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log_Test')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Deploy Test",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 538000002
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable_14": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "partiallySucceeded"
                    },
                    "Case_failed_2": {
                      "actions": {
                        "Get_All_Logs_of_the_Build_2": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                              "parameters/Method": "GET",
                              "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                              "operationId": "HttpRequest",
                              "connectionName": "shared_visualstudioteamservices"
                            }
                          }
                        },
                        "Parse_All_Logs_2": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_All_Logs_of_the_Build_2')",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "value": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "lineCount": {
                                        "type": "integer"
                                      },
                                      "createdOn": {
                                        "type": "string"
                                      },
                                      "lastChangedOn": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "lineCount",
                                      "createdOn",
                                      "lastChangedOn",
                                      "id",
                                      "type",
                                      "url"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Get_All_Logs_of_the_Build_2": [
                              "Succeeded"
                            ]
                          }
                        },
                        "For_each_6": {
                          "type": "Foreach",
                          "foreach": "@outputs('Parse_All_Logs_2')?['body']?['value']",
                          "actions": {
                            "Get_specific_log_by_id_2": {
                              "type": "OpenApiConnection",
                              "inputs": {
                                "parameters": {
                                  "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                  "parameters/Method": "GET",
                                  "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs/@{item()?['id']}"
                                },
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                  "operationId": "HttpRequest",
                                  "connectionName": "shared_visualstudioteamservices"
                                }
                              }
                            },
                            "Condition_only_Error_2": {
                              "type": "If",
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@body('Get_specific_log_by_id_2')",
                                      "##[error]"
                                    ]
                                  }
                                ]
                              },
                              "actions": {
                                "Condition_Retry_2": {
                                  "type": "If",
                                  "expression": {
                                    "and": [
                                      {
                                        "less": [
                                          "@variables('Retry')",
                                          "@parameters('ALM_RetryMax (dyna_ALM_RetryMax)')"
                                        ]
                                      },
                                      {
                                        "contains": [
                                          "@body('Get_specific_log_by_id_2')",
                                          "Cannot start"
                                        ]
                                      }
                                    ]
                                  },
                                  "actions": {
                                    "Condition_10": {
                                      "type": "If",
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@variables('RetryBool')",
                                              false
                                            ]
                                          }
                                        ]
                                      },
                                      "actions": {
                                        "Increment_Retry_2": {
                                          "type": "IncrementVariable",
                                          "inputs": {
                                            "name": "Retry",
                                            "value": 1
                                          }
                                        },
                                        "Set_variable_33": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "RetryBool",
                                            "value": true
                                          },
                                          "runAfter": {
                                            "Set_newBuildId_1": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Delay_Retry_2": {
                                          "type": "Wait",
                                          "inputs": {
                                            "interval": {
                                              "count": "@parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)')",
                                              "unit": "Minute"
                                            }
                                          },
                                          "runAfter": {
                                            "Add_a_Retry_Log_test": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Add_a_Retry_Log_test": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "entityName": "dyna_almtrackinghistories",
                                              "item/dyna_name": "Deploy Test",
                                              "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                                              "item/dyna_buildid": "@variables('buildId')",
                                              "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{variables('buildId')}&view=results",
                                              "item/dyna_enddatetime": "@addMinutes(utcNow(),parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)'))",
                                              "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                                              "item/dyna_startdatetime": "@utcNow()",
                                              "item/statuscode": 538000004
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                              "operationId": "CreateRecord",
                                              "connectionName": "shared_commondataserviceforapps"
                                            }
                                          },
                                          "runAfter": {
                                            "Set_variable_33": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Queue_a_new_build_1": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                              "project": "@parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')",
                                              "buildDefId": "@variables('pipelineId')",
                                              "buildDetails/sourceBranch": "@triggerBody()?['text_1']"
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                              "operationId": "QueueNewBuild",
                                              "connectionName": "shared_visualstudioteamservices"
                                            }
                                          },
                                          "runAfter": {
                                            "Increment_Retry_2": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Set_newBuildId_1": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "buildId",
                                            "value": "@string(outputs('Queue_a_new_build_1')?['body/id'])"
                                          },
                                          "runAfter": {
                                            "Queue_a_new_build_1": [
                                              "Succeeded"
                                            ]
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {}
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Condition_5": {
                                        "type": "If",
                                        "expression": {
                                          "and": [
                                            {
                                              "equals": [
                                                "@variables('sentEmail')",
                                                false
                                              ]
                                            }
                                          ]
                                        },
                                        "actions": {
                                          "Send_an_email_(V2)_2": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "emailMessage/To": "@parameters('ALM_DLToNotify (dyna_ALM_DLToNotify)')",
                                                "emailMessage/Subject": "DevOps Error Automation ALM Accelerator",
                                                "emailMessage/Body": "<p class=\"editor-paragraph\">Orga DevOps : @{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}</p><p class=\"editor-paragraph\">Project DevOps : @{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">Solution : @{triggerBody()?['text_1']}</p><p class=\"editor-paragraph\">Type : <u><b><strong class=\"editor-text-bold editor-text-underline\">Deploy TEST</strong></b></u></p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">Build Link : @{concat(variables('linkDevOps'),variables('buildId'))}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">----------------------------------------------------------------------------------</p><br><p class=\"editor-paragraph\">@{body('Get_specific_log_by_id_2')}</p>",
                                                "emailMessage/Importance": "High"
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365",
                                                "operationId": "SendEmailV2",
                                                "connectionName": "shared_office365"
                                              }
                                            }
                                          },
                                          "Set_variable_28": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "sentEmail",
                                              "value": true
                                            },
                                            "runAfter": {
                                              "Send_an_email_(V2)_2": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_17": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "GoOnOrNot",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_28": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_16": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "DoUntilBooleanLoop",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_17": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Update_Log_9": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "entityName": "dyna_almtrackinghistories",
                                                "recordId": "@body('Add_a_new_Log_Test')?['dyna_almtrackinghistoryid']",
                                                "item/dyna_name": "Deploy Test",
                                                "item/dyna_enddatetime": "@utcNow()",
                                                "item/statuscode": 538000001
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                                "operationId": "UpdateRecord",
                                                "connectionName": "shared_commondataserviceforapps"
                                              }
                                            },
                                            "runAfter": {
                                              "Set_variable_16": [
                                                "Succeeded"
                                              ]
                                            }
                                          }
                                        },
                                        "else": {
                                          "actions": {}
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "actions": {}
                              },
                              "runAfter": {
                                "Get_specific_log_by_id_2": [
                                  "Succeeded"
                                ]
                              }
                            }
                          },
                          "runAfter": {
                            "Set_RetryBool_2": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_RetryBool_2": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "RetryBool",
                            "value": false
                          },
                          "runAfter": {
                            "Parse_All_Logs_2": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "failed"
                    }
                  },
                  "runAfter": {
                    "CurrentStatus_2": [
                      "Succeeded"
                    ]
                  }
                }
              },
              "runAfter": {
                "Add_a_new_Log_Test": [
                  "Succeeded"
                ]
              }
            },
            "Add_a_new_Log_Test": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "dyna_almtrackinghistories",
                  "item/dyna_name": "Deploy Test",
                  "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                  "item/dyna_buildid": "@variables('buildId')",
                  "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{variables('buildId')}&view=results",
                  "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                  "item/dyna_startdatetime": "@utcNow()",
                  "item/statuscode": 538000003
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "connectionName": "shared_commondataserviceforapps"
                }
              },
              "runAfter": {
                "Search_for_Build_id_Test": [
                  "Succeeded"
                ]
              }
            }
          },
          "else": {
            "actions": {}
          },
          "runAfter": {
            "QA_Only_-_2nd_Stage_Validation": [
              "Succeeded"
            ]
          }
        },
        "PROD_Only": {
          "type": "If",
          "expression": {
            "and": [
              {
                "equals": [
                  "@triggerBody()?['text_2']",
                  "PROD"
                ]
              },
              {
                "equals": [
                  "@variables('GoOnOrNot')",
                  true
                ]
              }
            ]
          },
          "actions": {
            "Reinit_variables_2": {
              "type": "Scope",
              "actions": {
                "ReInitialize_DoUntilBooleanLoop_2": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "DoUntilBooleanLoop",
                    "value": true
                  }
                },
                "ReInitialize_GoOnOrNot_2": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "GoOnOrNot",
                    "value": true
                  },
                  "runAfter": {
                    "ReInitialize_DoUntilBooleanLoop_2": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_SentEmail_3": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "sentEmail",
                    "value": false
                  },
                  "runAfter": {
                    "ReInitialize_GoOnOrNot_2": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_RetryBool_3": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "RetryBool",
                    "value": false
                  },
                  "runAfter": {
                    "Reinit_SentEmail_3": [
                      "Succeeded"
                    ]
                  }
                },
                "Reinit_Retry_3": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "Retry",
                    "value": 0
                  },
                  "runAfter": {
                    "Reinit_RetryBool_3": [
                      "Succeeded"
                    ]
                  }
                }
              }
            },
            "Delay_1min_waiting_for_the_build_to_run_1": {
              "type": "Wait",
              "inputs": {
                "interval": {
                  "count": 1,
                  "unit": "Minute"
                }
              },
              "runAfter": {
                "Reinit_variables_2": [
                  "Succeeded"
                ]
              }
            },
            "Search_for_Build_id_Prod": {
              "type": "Scope",
              "actions": {
                "List_pipelines_2": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "project": "@parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "ListPipelines",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  }
                },
                "For_each_7": {
                  "type": "Foreach",
                  "foreach": "@outputs('List_pipelines_2')?['body/value']",
                  "actions": {
                    "Condition_2": {
                      "type": "If",
                      "expression": {
                        "and": [
                          {
                            "contains": [
                              "@item()?['name']",
                              "deploy-prod-@{triggerBody()?['text_1']}"
                            ]
                          }
                        ]
                      },
                      "actions": {
                        "Set_variable_18": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "pipelineId",
                            "value": "@item()?['id']"
                          }
                        }
                      },
                      "else": {
                        "actions": {}
                      }
                    }
                  },
                  "runAfter": {
                    "List_pipelines_2": [
                      "Succeeded"
                    ]
                  }
                },
                "Search_BuildId_2": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "parameters/Method": "GET",
                      "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds?definitions=@{variables('pipelineId')}&maxBuildsPerDefinition=1&queryOrder=queueTimeDescending"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "HttpRequest",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  },
                  "runAfter": {
                    "For_each_7": [
                      "Succeeded"
                    ]
                  }
                },
                "Parse_JSON_BuildId_2": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@body('Search_BuildId_2')",
                    "schema": {
                      "type": "object",
                      "properties": {
                        "count": {
                          "type": "integer"
                        },
                        "value": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "_links": {
                                "type": "object",
                                "properties": {
                                  "self": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "web": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "sourceVersionDisplayUri": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "timeline": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "badge": {
                                    "type": "object",
                                    "properties": {
                                      "href": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                }
                              },
                              "properties": {
                                "type": "object",
                                "properties": {}
                              },
                              "tags": {
                                "type": "array"
                              },
                              "validationResults": {
                                "type": "array"
                              },
                              "plans": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "planId": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "planId"
                                  ]
                                }
                              },
                              "triggerInfo": {
                                "type": "object",
                                "properties": {
                                  "ci.sourceBranch": {
                                    "type": "string"
                                  },
                                  "ci.sourceSha": {
                                    "type": "string"
                                  },
                                  "ci.message": {
                                    "type": "string"
                                  },
                                  "ci.triggerRepository": {
                                    "type": "string"
                                  }
                                }
                              },
                              "id": {
                                "type": "integer"
                              },
                              "buildNumber": {
                                "type": "string"
                              },
                              "status": {
                                "type": "string"
                              },
                              "queueTime": {
                                "type": "string"
                              },
                              "url": {
                                "type": "string"
                              },
                              "definition": {
                                "type": "object",
                                "properties": {
                                  "drafts": {
                                    "type": "array"
                                  },
                                  "id": {
                                    "type": "integer"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "uri": {
                                    "type": "string"
                                  },
                                  "path": {
                                    "type": "string"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "queueStatus": {
                                    "type": "string"
                                  },
                                  "revision": {
                                    "type": "integer"
                                  },
                                  "project": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "description": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      },
                                      "state": {
                                        "type": "string"
                                      },
                                      "revision": {
                                        "type": "integer"
                                      },
                                      "visibility": {
                                        "type": "string"
                                      },
                                      "lastUpdateTime": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                }
                              },
                              "buildNumberRevision": {
                                "type": "integer"
                              },
                              "project": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "description": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "state": {
                                    "type": "string"
                                  },
                                  "revision": {
                                    "type": "integer"
                                  },
                                  "visibility": {
                                    "type": "string"
                                  },
                                  "lastUpdateTime": {
                                    "type": "string"
                                  }
                                }
                              },
                              "uri": {
                                "type": "string"
                              },
                              "sourceBranch": {
                                "type": "string"
                              },
                              "sourceVersion": {
                                "type": "string"
                              },
                              "queue": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "pool": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "integer"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "isHosted": {
                                        "type": "boolean"
                                      }
                                    }
                                  }
                                }
                              },
                              "priority": {
                                "type": "string"
                              },
                              "reason": {
                                "type": "string"
                              },
                              "requestedFor": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "requestedBy": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "lastChangedDate": {
                                "type": "string"
                              },
                              "lastChangedBy": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "_links": {
                                    "type": "object",
                                    "properties": {
                                      "avatar": {
                                        "type": "object",
                                        "properties": {
                                          "href": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "uniqueName": {
                                    "type": "string"
                                  },
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "descriptor": {
                                    "type": "string"
                                  }
                                }
                              },
                              "orchestrationPlan": {
                                "type": "object",
                                "properties": {
                                  "planId": {
                                    "type": "string"
                                  }
                                }
                              },
                              "logs": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  }
                                }
                              },
                              "repository": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "url": {
                                    "type": "string"
                                  },
                                  "clean": {},
                                  "checkoutSubmodules": {
                                    "type": "boolean"
                                  }
                                }
                              },
                              "retainedByRelease": {
                                "type": "boolean"
                              },
                              "triggeredByBuild": {},
                              "appendCommitMessageToRunName": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "_links",
                              "properties",
                              "tags",
                              "validationResults",
                              "plans",
                              "triggerInfo",
                              "id",
                              "buildNumber",
                              "status",
                              "queueTime",
                              "url",
                              "definition",
                              "buildNumberRevision",
                              "project",
                              "uri",
                              "sourceBranch",
                              "sourceVersion",
                              "queue",
                              "priority",
                              "reason",
                              "requestedFor",
                              "requestedBy",
                              "lastChangedDate",
                              "lastChangedBy",
                              "orchestrationPlan",
                              "logs",
                              "repository",
                              "retainedByRelease",
                              "triggeredByBuild",
                              "appendCommitMessageToRunName"
                            ]
                          }
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Search_BuildId_2": [
                      "Succeeded"
                    ]
                  }
                },
                "For_each_8": {
                  "type": "Foreach",
                  "foreach": "@outputs('Parse_JSON_BuildId_2')?['body']?['value']",
                  "actions": {
                    "Set_buildId_for_prod_environment": {
                      "type": "SetVariable",
                      "inputs": {
                        "name": "buildId",
                        "value": "@string(item()?['id'])"
                      }
                    }
                  },
                  "runAfter": {
                    "Parse_JSON_BuildId_2": [
                      "Succeeded"
                    ]
                  }
                }
              },
              "runAfter": {
                "Delay_1min_waiting_for_the_build_to_run_1": [
                  "Succeeded"
                ]
              }
            },
            "Do_until_prod": {
              "type": "Until",
              "expression": "@equals(variables('DoUntilBooleanLoop'),false)",
              "limit": {
                "count": 3600,
                "timeout": "PT24H"
              },
              "actions": {
                "Get_Status_of_Export_Git_Build_3": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                      "parameters/Method": "GET",
                      "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                      "operationId": "HttpRequest",
                      "connectionName": "shared_visualstudioteamservices"
                    }
                  }
                },
                "Parse_Get_Status_of_Export_Git_Build_3": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@body('Get_Status_of_Export_Git_Build_3')",
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "web": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "sourceVersionDisplayUri": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "timeline": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            },
                            "badge": {
                              "type": "object",
                              "properties": {
                                "href": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {}
                        },
                        "tags": {
                          "type": "array"
                        },
                        "validationResults": {
                          "type": "array"
                        },
                        "plans": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "planId": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "planId"
                            ]
                          }
                        },
                        "templateParameters": {
                          "type": "object",
                          "properties": {
                            "Branch": {
                              "type": "string"
                            },
                            "BranchToCreate": {
                              "type": "string"
                            },
                            "BuildDefinitionId": {
                              "type": "string"
                            },
                            "CommitMessage": {
                              "type": "string"
                            },
                            "CommitScope": {
                              "type": "string"
                            },
                            "DATA": {
                              "type": "string"
                            },
                            "Email": {
                              "type": "string"
                            },
                            "EnvironmentName": {
                              "type": "string"
                            },
                            "ImportUnmanaged": {
                              "type": "string"
                            },
                            "PipelineId": {
                              "type": "string"
                            },
                            "PortalSiteName": {
                              "type": "string"
                            },
                            "Project": {
                              "type": "string"
                            },
                            "PublishCustomizations": {
                              "type": "string"
                            },
                            "Repo": {
                              "type": "string"
                            },
                            "ServiceConnectionName": {
                              "type": "string"
                            },
                            "ServiceConnectionUrl": {
                              "type": "string"
                            },
                            "SolutionName": {
                              "type": "string"
                            },
                            "UserName": {
                              "type": "string"
                            },
                            "AgentPool": {
                              "type": "string"
                            },
                            "VMImage": {
                              "type": "string"
                            }
                          }
                        },
                        "triggerInfo": {
                          "type": "object",
                          "properties": {}
                        },
                        "id": {
                          "type": "integer"
                        },
                        "buildNumber": {
                          "type": "string"
                        },
                        "Status": {
                          "type": "string"
                        },
                        "result": {
                          "type": "string"
                        },
                        "queueTime": {
                          "type": "string"
                        },
                        "startTime": {
                          "type": "string"
                        },
                        "finishTime": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "definition": {
                          "type": "object",
                          "properties": {
                            "drafts": {
                              "type": "array"
                            },
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "uri": {
                              "type": "string"
                            },
                            "path": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "queueStatus": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "project": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "url": {
                                  "type": "string"
                                },
                                "state": {
                                  "type": "string"
                                },
                                "revision": {
                                  "type": "integer"
                                },
                                "visibility": {
                                  "type": "string"
                                },
                                "lastUpdateTime": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        },
                        "project": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "description": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "state": {
                              "type": "string"
                            },
                            "revision": {
                              "type": "integer"
                            },
                            "visibility": {
                              "type": "string"
                            },
                            "lastUpdateTime": {
                              "type": "string"
                            }
                          }
                        },
                        "uri": {
                          "type": "string"
                        },
                        "sourceBranch": {
                          "type": "string"
                        },
                        "sourceVersion": {
                          "type": "string"
                        },
                        "queue": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "name": {
                              "type": "string"
                            },
                            "pool": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "integer"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "isHosted": {
                                  "type": "boolean"
                                }
                              }
                            }
                          }
                        },
                        "priority": {
                          "type": "string"
                        },
                        "reason": {
                          "type": "string"
                        },
                        "requestedFor": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "requestedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "lastChangedDate": {
                          "type": "string"
                        },
                        "lastChangedBy": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "_links": {
                              "type": "object",
                              "properties": {
                                "avatar": {
                                  "type": "object",
                                  "properties": {
                                    "href": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "id": {
                              "type": "string"
                            },
                            "uniqueName": {
                              "type": "string"
                            },
                            "imageUrl": {
                              "type": "string"
                            },
                            "descriptor": {
                              "type": "string"
                            }
                          }
                        },
                        "orchestrationPlan": {
                          "type": "object",
                          "properties": {
                            "planId": {
                              "type": "string"
                            }
                          }
                        },
                        "logs": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer"
                            },
                            "type": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            }
                          }
                        },
                        "repository": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "url": {
                              "type": "string"
                            },
                            "clean": {},
                            "checkoutSubmodules": {
                              "type": "boolean"
                            }
                          }
                        },
                        "retainedByRelease": {
                          "type": "boolean"
                        },
                        "appendCommitMessageToRunName": {
                          "type": "boolean"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Get_Status_of_Export_Git_Build_3": [
                      "Succeeded"
                    ]
                  }
                },
                "Set_Build_Status_3": {
                  "type": "SetVariable",
                  "inputs": {
                    "name": "buildStatus",
                    "value": "@body('Parse_Get_Status_of_Export_Git_Build_3')?['result']"
                  },
                  "runAfter": {
                    "Parse_Get_Status_of_Export_Git_Build_3": [
                      "Succeeded"
                    ]
                  }
                },
                "CurrentStatus_3": {
                  "type": "Compose",
                  "inputs": "@variables('buildStatus')",
                  "runAfter": {
                    "Set_Build_Status_3": [
                      "Succeeded"
                    ]
                  }
                },
                "Switch_3": {
                  "type": "Switch",
                  "expression": "@outputs('CurrentStatus_3')",
                  "default": {
                    "actions": {
                      "Delay_1mn_each_call_3": {
                        "type": "Wait",
                        "inputs": {
                          "interval": {
                            "count": 1,
                            "unit": "Minute"
                          }
                        }
                      }
                    }
                  },
                  "cases": {
                    "Case_Success_3": {
                      "actions": {
                        "Set_variable_42": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_19": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_19": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": true
                          }
                        },
                        "Update_Log_10": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log_Prod')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Deploy Production",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 1
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable_42": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "succeeded"
                    },
                    "Case_partiallySucceeded_3": {
                      "actions": {
                        "Set_variable_20": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "DoUntilBooleanLoop",
                            "value": false
                          },
                          "runAfter": {
                            "Set_variable_21": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_variable_21": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "GoOnOrNot",
                            "value": false
                          }
                        },
                        "Update_Log_11": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "dyna_almtrackinghistories",
                              "recordId": "@body('Add_a_new_Log_Prod')?['dyna_almtrackinghistoryid']",
                              "item/dyna_name": "Deploy Production",
                              "item/dyna_enddatetime": "@utcNow()",
                              "item/statuscode": 538000002
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "runAfter": {
                            "Set_variable_20": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "partiallySucceeded"
                    },
                    "Case_failed_3": {
                      "actions": {
                        "Get_All_Logs_of_the_Build_3": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                              "parameters/Method": "GET",
                              "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                              "operationId": "HttpRequest",
                              "connectionName": "shared_visualstudioteamservices"
                            }
                          }
                        },
                        "Parse_All_Logs_3": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_All_Logs_of_the_Build_3')",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "value": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "lineCount": {
                                        "type": "integer"
                                      },
                                      "createdOn": {
                                        "type": "string"
                                      },
                                      "lastChangedOn": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "lineCount",
                                      "createdOn",
                                      "lastChangedOn",
                                      "id",
                                      "type",
                                      "url"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Get_All_Logs_of_the_Build_3": [
                              "Succeeded"
                            ]
                          }
                        },
                        "For_each_9": {
                          "type": "Foreach",
                          "foreach": "@outputs('Parse_All_Logs_3')?['body']?['value']",
                          "actions": {
                            "Get_specific_log_by_id_3": {
                              "type": "OpenApiConnection",
                              "inputs": {
                                "parameters": {
                                  "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                  "parameters/Method": "GET",
                                  "parameters/Uri": "@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_apis/build/builds/@{variables('buildId')}/logs/@{item()?['id']}"
                                },
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                  "operationId": "HttpRequest",
                                  "connectionName": "shared_visualstudioteamservices"
                                }
                              }
                            },
                            "Condition_only_Error_3": {
                              "type": "If",
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@body('Get_specific_log_by_id_3')",
                                      "##[error]"
                                    ]
                                  }
                                ]
                              },
                              "actions": {
                                "Condition_Retry_3": {
                                  "type": "If",
                                  "expression": {
                                    "and": [
                                      {
                                        "less": [
                                          "@variables('Retry')",
                                          "@parameters('ALM_RetryMax (dyna_ALM_RetryMax)')"
                                        ]
                                      },
                                      {
                                        "contains": [
                                          "@body('Get_specific_log_by_id_3')",
                                          "Cannot start"
                                        ]
                                      }
                                    ]
                                  },
                                  "actions": {
                                    "Condition_11": {
                                      "type": "If",
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@variables('RetryBool')",
                                              false
                                            ]
                                          }
                                        ]
                                      },
                                      "actions": {
                                        "Increment_Retry_3": {
                                          "type": "IncrementVariable",
                                          "inputs": {
                                            "name": "Retry",
                                            "value": 1
                                          }
                                        },
                                        "Set_variable_34": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "RetryBool",
                                            "value": true
                                          },
                                          "runAfter": {
                                            "Set_newBuildId_2": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Delay_Retry_3": {
                                          "type": "Wait",
                                          "inputs": {
                                            "interval": {
                                              "count": "@parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)')",
                                              "unit": "Minute"
                                            }
                                          },
                                          "runAfter": {
                                            "Add_Retry_Log_Prod": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Add_Retry_Log_Prod": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "entityName": "dyna_almtrackinghistories",
                                              "item/dyna_name": "Deploy Production",
                                              "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                                              "item/dyna_buildid": "@variables('buildId')",
                                              "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{variables('buildId')}&view=results",
                                              "item/dyna_enddatetime": "@addMinutes(utcNow(),parameters('ALM_RetryDelayMinutes (dyna_ALM_RetryDelayMinutes)'))",
                                              "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                                              "item/dyna_startdatetime": "@utcNow()",
                                              "item/statuscode": 538000004
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                              "operationId": "CreateRecord",
                                              "connectionName": "shared_commondataserviceforapps"
                                            }
                                          },
                                          "runAfter": {
                                            "Set_variable_34": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Queue_a_new_build_2": {
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "parameters": {
                                              "account": "@parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')",
                                              "project": "@parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')",
                                              "buildDefId": "@variables('pipelineId')",
                                              "buildDetails/sourceBranch": "main"
                                            },
                                            "host": {
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_visualstudioteamservices",
                                              "operationId": "QueueNewBuild",
                                              "connectionName": "shared_visualstudioteamservices"
                                            }
                                          },
                                          "runAfter": {
                                            "Increment_Retry_3": [
                                              "Succeeded"
                                            ]
                                          }
                                        },
                                        "Set_newBuildId_2": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "buildId",
                                            "value": "@string(outputs('Queue_a_new_build_2')?['body/id'])"
                                          },
                                          "runAfter": {
                                            "Queue_a_new_build_2": [
                                              "Succeeded"
                                            ]
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {}
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Condition_6": {
                                        "type": "If",
                                        "expression": {
                                          "and": [
                                            {
                                              "equals": [
                                                "@variables('sentEmail')",
                                                false
                                              ]
                                            }
                                          ]
                                        },
                                        "actions": {
                                          "Send_an_email_(V2)_3": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "emailMessage/To": "@parameters('ALM_DLToNotify (dyna_ALM_DLToNotify)')",
                                                "emailMessage/Subject": "DevOps Error Automation ALM Accelerator",
                                                "emailMessage/Body": "<p class=\"editor-paragraph\">Orga DevOps : @{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}</p><p class=\"editor-paragraph\">Project DevOps : @{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">Solution : @{triggerBody()?['text_1']}</p><p class=\"editor-paragraph\">Type : <u><b><strong style=\"color: rgb(208, 2, 27);\" class=\"editor-text-bold editor-text-underline\">Deploy Production</strong></b></u></p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">Build Link : @{concat(variables('linkDevOps'),variables('buildId'))}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">----------------------------------------------------------------------------------</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">@{body('Get_specific_log_by_id_3')}</p>",
                                                "emailMessage/Importance": "High"
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365",
                                                "operationId": "SendEmailV2",
                                                "connectionName": "shared_office365"
                                              }
                                            }
                                          },
                                          "Set_variable_30": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "sentEmail",
                                              "value": true
                                            },
                                            "runAfter": {
                                              "Send_an_email_(V2)_3": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_23": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "GoOnOrNot",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_30": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Set_variable_22": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "DoUntilBooleanLoop",
                                              "value": false
                                            },
                                            "runAfter": {
                                              "Set_variable_23": [
                                                "Succeeded"
                                              ]
                                            }
                                          },
                                          "Update_Log_12": {
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "parameters": {
                                                "entityName": "dyna_almtrackinghistories",
                                                "recordId": "@body('Add_a_new_Log_Prod')?['dyna_almtrackinghistoryid']",
                                                "item/dyna_name": "Deploy Production",
                                                "item/dyna_enddatetime": "@utcNow()",
                                                "item/statuscode": 538000001
                                              },
                                              "host": {
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                                "operationId": "UpdateRecord",
                                                "connectionName": "shared_commondataserviceforapps"
                                              }
                                            },
                                            "runAfter": {
                                              "Set_variable_22": [
                                                "Succeeded"
                                              ]
                                            }
                                          }
                                        },
                                        "else": {
                                          "actions": {}
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "actions": {}
                              },
                              "runAfter": {
                                "Get_specific_log_by_id_3": [
                                  "Succeeded"
                                ]
                              }
                            }
                          },
                          "runAfter": {
                            "Set_RetryBool_3": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Set_RetryBool_3": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "RetryBool",
                            "value": false
                          },
                          "runAfter": {
                            "Parse_All_Logs_3": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "case": "failed"
                    }
                  },
                  "runAfter": {
                    "CurrentStatus_3": [
                      "Succeeded"
                    ]
                  }
                }
              },
              "runAfter": {
                "Add_a_new_Log_Prod": [
                  "Succeeded"
                ]
              }
            },
            "Add_a_new_Log_Prod": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "dyna_almtrackinghistories",
                  "item/dyna_name": "Deploy Production",
                  "item/dyna_ALMDeployment@odata.bind": "dyna_almdeployments(@{triggerBody()?['text_3']})",
                  "item/dyna_buildid": "@variables('buildId')",
                  "item/dyna_devopsbuild": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId=@{variables('buildId')}&view=results",
                  "item/dyna_Solution@odata.bind": "dyna_almsolutions(@{triggerBody()?['text_4']})",
                  "item/dyna_startdatetime": "@utcNow()",
                  "item/statuscode": 538000003
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "connectionName": "shared_commondataserviceforapps"
                }
              },
              "runAfter": {
                "Search_for_Build_id_Prod": [
                  "Succeeded"
                ]
              }
            }
          },
          "else": {
            "actions": {}
          },
          "runAfter": {
            "QA_Only_-_3rd_Stage_Test": [
              "Succeeded"
            ]
          }
        },
        "Respond_to_a_Power_App_or_flow": {
          "type": "Response",
          "kind": "PowerApp",
          "inputs": {
            "schema": {
              "type": "object",
              "properties": {},
              "additionalProperties": {}
            },
            "statusCode": 200
          },
          "runAfter": {
            "PROD_Only": [
              "Succeeded"
            ]
          }
        },
        "Initialize_sentEmail": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "sentEmail",
                "type": "boolean",
                "value": false
              }
            ]
          },
          "runAfter": {
            "Initialize_pipelineId": [
              "Succeeded"
            ]
          }
        },
        "Initialize_linkBuild": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "linkBuild",
                "type": "string",
                "value": "https://dev.azure.com/@{parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)')}/@{parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)')}/_build/results?buildId="
              }
            ]
          },
          "runAfter": {
            "Initialize_sentEmail": [
              "Succeeded"
            ]
          }
        },
        "Initialize_Retry": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "Retry",
                "type": "integer",
                "value": 0
              }
            ]
          },
          "runAfter": {
            "Initialize_linkBuild": [
              "Succeeded"
            ]
          }
        },
        "Initialize_RetryBool": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "RetryBool",
                "type": "boolean",
                "value": false
              }
            ]
          },
          "runAfter": {
            "Initialize_Retry": [
              "Succeeded"
            ]
          }
        },
        "Initialize_LinkDevOps": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "linkDevOps",
                "type": "string",
                "value": "@replace(concat('https://dev.azure.com/',parameters('ALM_DevOps_OrganizationName (dyna_almdevopsorganizationname)'),'/',parameters('ALM_DevOps_ProjectName (dyna_almdevopsprojectname)'),'/','_build/results?buildId='),' ','%20')"
              }
            ]
          },
          "runAfter": {
            "Initialize_RetryBool": [
              "Succeeded"
            ]
          }
        }
      },
      "description": "Helper ChildFlow to know the deployment process at which stage we are and if we can continue or not the other solution deployment."
    },
    "templateName": null
  },
  "schemaVersion": "1.0.0.0"
}